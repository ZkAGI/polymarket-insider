=== Session 2026-01-09 ===

COMPLETED: SETUP-001 - Initialize Git repository
- Created comprehensive .gitignore for Node.js/TypeScript project
- Includes: node_modules, dist, .next, .env*, coverage, IDE files, OS files, logs, TypeScript build info, Prisma DB files
- Created initial commit with all foundational files
- Verified: .git folder exists and properly configured

COMPLETED: SETUP-002 - Initialize package.json
- Created package.json with project metadata (name, version, description)
- Added scripts: dev, build, start, test, test:watch, lint, lint:fix, format, format:check, typecheck
- Set up for Next.js + Vitest + ESLint + Prettier
- Created .nvmrc to lock Node version to 20.17.0
- Verified: npm install runs with 0 vulnerabilities

COMPLETED: SETUP-003 - Configure TypeScript
- Installed typescript and @types/node as dev dependencies
- Created tsconfig.json with strict mode and additional strict checks
- Configured path aliases: @/*, @/api/*, @/components/*, @/lib/*, @/utils/*
- Set outDir to ./dist, moduleResolution to "bundler"
- Added extra strict options: noUncheckedIndexedAccess, noImplicitReturns, noUnusedLocals, noUnusedParameters
- Created src/index.ts as test file
- Verified: tsc --noEmit passes with no errors

COMPLETED: SETUP-004 - Configure ESLint and Prettier
- Installed eslint, prettier, typescript-eslint, and related plugins
- Created eslint.config.mjs (flat config for ESLint 9.x)
- Created .prettierrc with formatting preferences (semi, double quotes, 100 print width)
- Created .prettierignore to exclude node_modules, dist, etc.
- Updated lint scripts in package.json for ESLint 9.x compatibility
- Verified: npm run lint passes with no errors
- Verified: npm run format works correctly

COMPLETED: SETUP-005 - Set up project directory structure
- Created src/ with subdirectories: api, detection, ui, notifications, ai, utils
- Created tests/ with matching structure (api, detection, ui, notifications, ai, utils)
- Created config/ for configuration files
- Added .gitkeep files to ensure empty directories are tracked
- Verified: All directories exist with correct structure

COMPLETED: SETUP-006 - Configure environment variables
- Installed dotenv package
- Created .env.example with all required variables (DATABASE_URL, API URLs, notification settings, whale thresholds)
- Created config/env.ts with typed environment access and validation
- Includes helper functions: getEnvVar, getEnvVarOptional, getEnvVarAsNumber, getEnvVarAsBoolean
- .env already in .gitignore from SETUP-001
- Verified: typecheck passes on config/env.ts
- Verified: .env.example can be copied to .env successfully

COMPLETED: SETUP-007 - Set up testing framework
- Installed vitest and @vitest/coverage-v8 as dev dependencies
- Created vitest.config.ts with:
  - Node environment, globals enabled
  - Test file patterns: tests/**/*.test.ts, tests/**/*.spec.ts
  - Coverage with v8 provider
  - Path aliases matching tsconfig.json
- Created tests/index.test.ts with 7 sample tests
- Verified: npm test runs successfully with all 7 tests passing

COMPLETED: SETUP-008 - Set up database with Prisma
- Installed prisma (dev) and @prisma/client
- Created prisma/schema.prisma with PostgreSQL provider
- Initial schema includes models:
  - Market: Polymarket market data (id, slug, question, category, volume, etc.)
  - Outcome: Market outcomes with probabilities
  - Wallet: Tracked wallet addresses (whale/insider flags)
  - Trade: Individual trades with USD values
  - PriceHistory: Price data for charting
  - Alert: Notification alerts
- DATABASE_URL already configured in .env from SETUP-006
- Verified: npx prisma validate passes

COMPLETED: SETUP-009 - Set up Next.js frontend
- Installed next, react, react-dom and @types/react, @types/react-dom
- Created app/ directory with App Router structure
- Created next.config.ts with reactStrictMode enabled
- Created app/layout.tsx with metadata (title, description)
- Created app/page.tsx with landing page content
- Updated tsconfig.json with @/app/* path alias
- Verified: npm run dev starts server at localhost:3000
- Verified: App renders correctly with title and content

COMPLETED: SETUP-010 - Configure Tailwind CSS
- Installed tailwindcss, postcss, autoprefixer, @tailwindcss/postcss
- Note: Tailwind CSS v4 requires @tailwindcss/postcss plugin instead of tailwindcss
- Created postcss.config.js with @tailwindcss/postcss and autoprefixer
- Created app/globals.css with @import "tailwindcss" (v4 syntax)
- Added CSS custom properties for theme (whale and insider colors)
- Created custom @utility text-balance and @theme directives
- Updated app/layout.tsx to import globals.css
- Updated app/page.tsx with Tailwind utility classes
- Tailwind v4 uses CSS-based configuration (no tailwind.config.js needed)
- Verified: Styling works correctly in browser, classes rendered in HTML
- Verified: typecheck, lint, and tests all pass

COMPLETED: API-GAMMA-001 - Gamma API client initialization
- Created src/api/gamma/ directory structure with modular architecture
- Created src/api/gamma/types.ts with comprehensive type definitions:
  - GammaOutcome: Market outcome with price/probability data
  - GammaMarket: Full market data structure
  - GammaMarketsResponse: Paginated response wrapper
  - GammaApiError: Error response type
  - GammaClientConfig: Client configuration options
  - GammaRequestOptions: Request options type
- Created src/api/gamma/client.ts with GammaClient class:
  - Uses native fetch API (no axios dependency needed)
  - Configurable base URL, API key, timeout, and retry count
  - Default config: baseUrl="https://gamma-api.polymarket.com", timeout=30s, retries=3
  - Automatic Authorization header when API key provided
  - Exponential backoff retry logic for 5xx errors
  - Does not retry on 4xx client errors
  - Custom GammaApiException class for typed error handling
  - get<T>() and post<T>() convenience methods
  - Singleton gammaClient export for convenience
  - createGammaClient() factory function for custom instances
- Created src/api/gamma/index.ts exporting all types and classes
- Created tests/api/gamma/client.test.ts with 15 test cases covering:
  - Constructor and configuration
  - Factory function and singleton
  - GET and POST requests
  - Authorization header handling
  - Error handling and retry logic
  - Empty response handling
- Verified: TypeScript typecheck (tsc --noEmit) passes with no errors
- NOTE: Tests require Node 18+ to run (vitest uses modern regex features)

NOTES:
- Project uses Node.js v20.17.0 (run `nvm use` to switch)
- ESLint 9.x uses flat config (eslint.config.mjs) instead of .eslintrc.js
- Run `npm test` for single run, `npm run test:watch` for watch mode
- Run `npx prisma db push` to sync schema with database
- Run `npm run dev` to start Next.js dev server
- Tailwind CSS v4 uses @import "tailwindcss" and CSS-based config (@theme directive)
- IMPORTANT: Ensure Node.js v20.17.0 is active before running npm commands

COMPLETED: API-GAMMA-002 - Fetch all active markets
- Created src/api/gamma/markets.ts with:
  - getActiveMarkets() function for fetching paginated active markets
  - getAllActiveMarkets() function for fetching all pages automatically
  - GetActiveMarketsOptions interface for request configuration
  - GetActiveMarketsResult interface for typed responses
- Features:
  - Automatic filtering for active=true, closed=false
  - Pagination support with limit/offset
  - Category filtering support
  - Sort options (sortBy, order)
  - Custom client injection for testing
  - Handles both array and paginated response formats
  - Safety limit in getAllActiveMarkets to prevent infinite loops
- Updated src/api/gamma/index.ts to export new functions and types
- Created tests/api/gamma/markets.test.ts with 18 test cases covering:
  - Basic functionality with default options
  - Query string building for filtering
  - Paginated and array response format handling
  - Inactive market filtering
  - All options (limit, offset, category, sortBy, order, client)
  - hasMore calculation logic
  - getAllActiveMarkets pagination and safety limit
- Verified: TypeScript types are correct

COMPLETED: API-GAMMA-003 - Fetch market by ID
- Added getMarketById() function to src/api/gamma/markets.ts
- Accepts marketId string parameter
- Returns GammaMarket or null if not found
- Features:
  - URL encodes market ID for safe API requests
  - Returns null for empty/whitespace-only IDs (no API call made)
  - Returns null for 404 responses (market not found)
  - Re-throws other API errors (5xx, 403, 400, etc.)
  - Supports custom GammaClient via options parameter
- Created GetMarketByIdOptions interface for configuration
- Updated src/api/gamma/index.ts to export new function and type
- Added 10 test cases to tests/api/gamma/markets.test.ts:
  - Successful fetch by ID
  - URL encoding for special characters in IDs
  - Full market details verification
  - Custom client injection
  - 404 handling (returns null)
  - Empty ID handling (returns null, no API call)
  - Whitespace-only ID handling (returns null, no API call)
  - Server error handling (throws GammaApiException)
  - Forbidden error handling (throws GammaApiException)
  - Bad request error handling (throws GammaApiException)
- Verified: TypeScript typecheck (tsc --noEmit) passes with no errors
- Next up: API-GAMMA-004

COMPLETED: API-GAMMA-004 - Fetch market by slug
- Added getMarketBySlug() function to src/api/gamma/markets.ts
- Added parseSlugFromUrl() helper function to extract slug from Polymarket URLs
- Accepts slug string parameter (can be raw slug or full Polymarket URL)
- Returns GammaMarket or null if not found
- Features:
  - parseSlugFromUrl() handles multiple URL formats:
    - Full URLs: https://polymarket.com/event/slug-name
    - URLs without protocol: polymarket.com/event/slug-name
    - Relative paths: /event/slug-name
    - Raw slugs: slug-name
    - URLs with query params and hash fragments
  - Queries the /markets endpoint with slug filter
  - URL encodes slug for safe API requests
  - Returns null for invalid/empty slugs (no API call made)
  - Returns null for 404 responses (market not found)
  - Finds exact case-insensitive match when multiple results returned
  - Falls back to first result if no exact match
  - Re-throws other API errors (5xx, 403, 429, etc.)
  - Supports custom GammaClient via options parameter
- Created GetMarketBySlugOptions interface for configuration
- Updated src/api/gamma/index.ts to export new functions and types
- Added 35+ test cases to tests/api/gamma/markets.test.ts covering:
  - parseSlugFromUrl tests:
    - Valid URL formats (full, without protocol, with www, relative)
    - Query params and hash fragments
    - Raw slugs and edge cases
    - Invalid inputs (empty, whitespace, invalid paths)
  - getMarketBySlug tests:
    - Successful fetch by slug
    - URL parsing integration
    - Paginated response handling
    - Case-insensitive matching
    - Custom client injection
    - Not found handling (empty response, 404)
    - Error handling (500, 403, 429)
- Implementation follows established patterns from getMarketById
- Created scripts/init.sh for easier development setup with nvm
- NOTE: Tests require Node 20+ to run (project uses .nvmrc with v20.17.0)

COMPLETED: API-GAMMA-005 - Fetch market outcomes
- Created src/api/gamma/types.ts additions:
  - MarketOutcome interface with probability field (0-100 scale)
  - MarketOutcomesResult interface with all outcome data
- Added functions to src/api/gamma/markets.ts:
  - getMarketOutcomes(marketId) - fetch outcomes by market ID
  - getMarketOutcomesBySlug(slug) - fetch outcomes by slug or URL
  - toMarketOutcome() helper to convert raw outcomes
- Features:
  - Converts price (0-1) to probability (0-100%)
  - Calculates totalProbability to verify sum ~100%
  - Includes market status (active/closed)
  - Adds fetchedAt timestamp
  - Supports multi-outcome markets (not just Yes/No)
  - Custom client injection support
  - Returns null for non-existent markets
  - Throws GammaApiException for server errors
- Updated src/api/gamma/index.ts to export new functions and types
- Added 16 comprehensive tests in tests/api/gamma/markets.test.ts:
  - Probability calculation accuracy
  - Total probability calculation
  - clobTokenId handling
  - Market status inclusion
  - Timestamp verification
  - Multi-outcome market support
  - Non-100% probability handling
  - Custom client support
  - Not found handling
  - Error handling
  - Slug-based lookups
- Bug fixes in same session:
  - Fixed parseSlugFromUrl to properly handle raw slugs
  - Fixed test mock using mockResolvedValue vs mockResolvedValueOnce
- All tests pass (103 total)
- TypeScript typecheck passes
- Next up: API-GAMMA-006

COMPLETED: API-GAMMA-006 - Fetch market volume history
- Added new types to src/api/gamma/types.ts:
  - TimeInterval: "1h" | "4h" | "1d" | "1w" | "1m"
  - TimeRange: Interface for start/end dates
  - VolumeDataPoint: Time-series volume data point with timestamp, volume, tradeCount, cumulativeVolume
  - VolumeHistoryResult: Complete volume history result with metadata
- Created functions in src/api/gamma/markets.ts:
  - getMarketVolumeHistory(marketId, options): Fetch volume history by market ID
  - getMarketVolumeHistoryBySlug(slug, options): Fetch volume history by slug/URL
  - Helper functions: toISOString, toUnixTimestamp, getDefaultTimeRange, getIntervalMs
  - parseTimeseriesResponse: Parse API response (supports 'history' and 'data' formats)
  - generateSyntheticVolumeHistory: Fallback when API doesn't provide timeseries data
- Features:
  - Accepts market ID or slug (including full Polymarket URLs)
  - Configurable time range (default: last 30 days)
  - Configurable interval: 1h, 4h, 1d, 1w, 1m (default: 1d)
  - Supports both API formats: { history: [{t, v}] } and { data: [{timestamp, volume, tradeCount}] }
  - Calculates cumulative volume for each data point
  - Falls back to synthetic data distribution when timeseries API returns 404
  - Synthetic data respects market creation date
  - Custom client support for testing
- Updated src/api/gamma/index.ts exports:
  - Functions: getMarketVolumeHistory, getMarketVolumeHistoryBySlug
  - Types: TimeInterval, TimeRange, VolumeDataPoint, VolumeHistoryResult, GetMarketVolumeHistoryOptions
- Added 27 comprehensive tests in tests/api/gamma/markets.test.ts:
  - API timeseries data parsing (history and data formats)
  - Cumulative volume calculation
  - Unix timestamp to ISO conversion
  - Fallback to synthetic data on 404 or empty response
  - Respecting market creation date in synthetic data
  - Default and custom time ranges (string and Date objects)
  - Default and custom intervals
  - Custom client injection
  - Not found handling (null returns)
  - Error handling (500, 403 errors throw GammaApiException)
  - Result metadata (fetchedAt, question, totalTrades)
  - Slug-based lookups with options passthrough
- All tests pass (130 total, up from 103)
- TypeScript typecheck passes
- Next up: API-GAMMA-007

COMPLETED: API-GAMMA-007 - Fetch market price history
- Added new types to src/api/gamma/types.ts:
  - PriceDataPoint: Time-series price data point with timestamp, price, probability, volume
  - PriceHistoryResult: Complete price history result with metadata and statistics
- Created functions in src/api/gamma/markets.ts:
  - getMarketPriceHistory(marketId, options): Fetch price history by market ID
  - getMarketPriceHistoryBySlug(slug, options): Fetch price history by slug/URL
  - findOutcome(): Helper to find outcome by ID, name (case-insensitive), or index
  - parsePriceTimeseriesResponse(): Parse API response (supports history, prices, data formats)
  - generateSyntheticPriceHistory(): Fallback when API doesn't provide timeseries data
- Features:
  - Accepts market ID or slug (including full Polymarket URLs)
  - Flexible outcome selection: by ID, name (case-insensitive), partial match, or numeric index
  - Configurable time range (default: last 30 days)
  - Configurable interval: 1h, 4h, 1d, 1w, 1m (default: 1d)
  - Tries multiple API endpoint patterns to find price data
  - Converts price (0-1) to probability (0-100%)
  - Calculates statistics: minPrice, maxPrice, priceChange, priceChangePercent
  - Falls back to synthetic data with smooth progression when API returns 404
  - Synthetic data uses smoothstep function for realistic price movement
  - Custom client support for testing
- Updated src/api/gamma/index.ts exports:
  - Functions: getMarketPriceHistory, getMarketPriceHistoryBySlug
  - Types: PriceDataPoint, PriceHistoryResult, GetMarketPriceHistoryOptions
- Added 37 comprehensive tests in tests/api/gamma/markets.test.ts:
  - Probability calculation from price
  - Statistics calculation (min, max, priceChange, priceChangePercent)
  - Current price and probability from market data
  - clobTokenId inclusion when available
  - Outcome selection: default to first, by name (case-insensitive), by index, by ID, partial match
  - Invalid outcome handling (returns null)
  - API response parsing (history, prices, data formats)
  - Volume data in price history
  - Fallback to synthetic data on 404
  - Synthetic data respects market creation date
  - Time range and interval options
  - Custom client injection
  - Not found handling (null returns for market/outcome not found)
  - Error handling (500, 403 errors throw GammaApiException)
  - Slug-based lookups with URL parsing
- All tests pass (167 total, up from 130)
- TypeScript typecheck passes
- Next up: API-GAMMA-008

COMPLETED: API-GAMMA-008 - Fetch markets by category
- Added MarketCategory enum to src/api/gamma/types.ts:
  - Includes 14 categories: politics, crypto, sports, tech, business, science, entertainment, weather, geopolitics, legal, health, economy, culture, other
  - Each category has JSDoc description
- Created functions in src/api/gamma/markets.ts:
  - getMarketsByCategory(category, options): Fetch markets filtered by category
  - getAllMarketsByCategory(category, options): Fetch all markets in a category with pagination
  - getCategoryCounts(options): Get counts of markets in each category
  - buildCategoryQueryString(): Helper to build API query strings with category filter
- Features:
  - Accepts both MarketCategory enum values and string categories
  - Uses API `tag` parameter for category filtering
  - Client-side category filtering as safety check (case-insensitive)
  - activeOnly option (default true) to filter active/closed markets
  - Pagination support with limit/offset
  - Sorting support with sortBy and order (asc/desc) options
  - hasMore calculation for pagination continuation
  - Safety limit in getAllMarketsByCategory to prevent infinite loops
  - Parallel category fetching in getCategoryCounts for efficiency
  - Error handling with graceful fallback in getCategoryCounts
  - Custom GammaClient injection support
- Updated src/api/gamma/index.ts exports:
  - Functions: getMarketsByCategory, getAllMarketsByCategory, getCategoryCounts
  - Enum: MarketCategory
  - Types: GetMarketsByCategoryOptions, GetMarketsByCategoryResult
- Added 28 comprehensive tests in tests/api/gamma/markets.test.ts:
  - Basic functionality with enum and string categories
  - Query string parameter verification (tag, active, closed)
  - Response format handling (array and paginated)
  - Category filtering (client-side safety filter)
  - Case-insensitive category matching
  - Active/closed market filtering
  - Pagination options (limit, offset)
  - hasMore calculation
  - Sorting options (sortBy, order)
  - Custom client injection
  - MarketCategory enum values verification
  - getAllMarketsByCategory pagination across pages
  - Safety limit enforcement
  - getCategoryCounts parallel fetching
  - Error handling in getCategoryCounts
- All tests pass (195 total, up from 167)
- TypeScript typecheck passes
- Next up: API-GAMMA-009

COMPLETED: API-GAMMA-009 - Fetch trending markets
- Created getTrendingMarkets function in src/api/gamma/markets.ts
- Added TrendingSortBy type for sort criteria: "volume", "volume24hr", "liquidity", "createdAt", "updatedAt"
- Added GetTrendingMarketsOptions interface with:
  - limit: Maximum number of trending markets to return (default: 10)
  - sortBy: Field to sort by for determining "trending" (default: "volume")
  - category: Optional category filter (MarketCategory enum or string)
  - activeOnly: Whether to include only active markets (default: true)
  - client: Custom GammaClient injection support
- Added GetTrendingMarketsResult interface with:
  - markets: Array of trending GammaMarket objects
  - count: Number of markets returned
  - sortBy: Sort criteria used
  - category: Category filter applied (if any)
  - fetchedAt: ISO timestamp
- Implementation features:
  - Queries API with sort parameters (order, ascending)
  - Client-side sorting for consistency across different API behaviors
  - Client-side filtering for activeOnly and category
  - Handles both array and paginated API response formats
  - Requests more than limit to account for client-side filtering
  - volume24hr uses volumeNum field, falls back to volume if unavailable
- Updated src/api/gamma/index.ts exports:
  - Added getTrendingMarkets function export
  - Added GetTrendingMarketsOptions, GetTrendingMarketsResult, TrendingSortBy type exports
- Added 32 comprehensive tests in tests/api/gamma/markets.test.ts covering:
  - Basic functionality (default options, sorting, query parameters)
  - Limit parameter handling (custom limit, default 10, larger than available)
  - sortBy parameter (volume, liquidity, createdAt, updatedAt, volume24hr)
  - Category filtering (enum, string, case-insensitive, API tag parameter)
  - activeOnly parameter (default filtering, include inactive)
  - Custom client injection
  - Error handling (500, 403, 429 errors throw GammaApiException)
  - Combined options (limit + sortBy + category)
  - Result structure verification
- All tests pass (227 total, up from 195)
- TypeScript typecheck passes
- ESLint passes
- Next up: API-GAMMA-010

COMPLETED: API-GAMMA-010 - Gamma API pagination handler
- Created src/api/gamma/paginate.ts with comprehensive pagination utilities:
  - paginate<T>(): Generic low-level pagination function with custom fetchPage callback
  - paginateEndpoint<T, R>(): Higher-level function for standard offset/limit pagination
  - paginateStream<T, R>(): Async generator for streaming/memory-efficient pagination
  - paginateParallel<T, R>(): Parallel page fetching for faster retrieval
  - createPaginator<T, R>(): Factory for creating reusable paginator functions
- Type definitions include:
  - PaginationConfig: Configuration for custom pagination
  - PageFetchParams: Parameters passed to page fetch function
  - PageResult: Result from fetching a single page
  - PaginatedResult: Final result with all items and metadata
  - PaginateEndpointConfig: Configuration for endpoint-based pagination
- Features implemented:
  - Both offset-based and cursor-based pagination support
  - Configurable page size (default: 100)
  - Safety limits: maxItems and maxPages to prevent runaway fetching
  - startOffset/startCursor for resuming pagination
  - delayBetweenPages for rate limiting
  - onPageFetched callback for progress reporting
  - totalCount tracking from API responses
  - Truncation tracking with reason (maxItems, maxPages, noMoreItems)
  - Generic types preserved through pagination
- Updated src/api/gamma/index.ts to export all pagination utilities
- Created tests/api/gamma/paginate.test.ts with 35 comprehensive tests covering:
  - Basic single and multi-page fetching
  - maxItems and maxPages limits
  - Offset and cursor handling
  - Progress callbacks
  - totalCount tracking
  - Delay between pages
  - paginateEndpoint URL building and item extraction
  - createPaginator reusability
  - paginateStream async iteration
  - paginateParallel parallel fetching
  - Edge cases (empty pages, errors, zero pageSize)
  - Type safety verification
- All tests pass (262 total, up from 227)
- TypeScript typecheck passes
- ESLint passes
- Next up: API-GAMMA-011

COMPLETED: API-GAMMA-011 - Gamma API rate limiter
- Created src/api/gamma/rate-limiter.ts with comprehensive rate limiting:
  - RateLimiter class implementing token bucket algorithm
  - RateLimiterError class for typed error handling
  - RateLimiterConfig interface for configuration
  - RateLimiterStats interface for monitoring
- Token bucket implementation features:
  - Configurable maxTokens (default: 10)
  - Configurable refillRate and refillInterval (default: 1 token/second)
  - Token consumption and automatic refill
  - Manual refill on each acquire() call for accuracy
- Request queuing features:
  - Configurable maxQueueSize (default: 100)
  - Configurable maxWaitTime timeout (default: 30s)
  - FIFO queue processing as tokens become available
  - Queue timeout with RateLimiterError thrown
- 429 response handling:
  - handleRateLimitResponse() method for Response objects
  - Parses Retry-After header (seconds or HTTP date)
  - Exponential backoff with jitter when no header
  - Configurable retryDelay and maxRetryDelay
  - pause() and resume() methods
- Helper functions and utilities:
  - createRateLimiter() factory function
  - getSharedRateLimiter() for singleton access
  - resetSharedRateLimiter() for testing/reset
  - withRateLimit() decorator for wrapping functions
  - executeWithRateLimit() for automatic 429 retry
- Statistics and monitoring:
  - getStats() returns current state and metrics
  - Tracks: totalRequests, throttledRequests, rateLimitedResponses, averageWaitTime
  - resetStats() to clear statistics only
  - reset() to clear all state including queue
  - dispose() for cleanup
- Updated src/api/gamma/index.ts exports:
  - Classes: RateLimiter, RateLimiterError
  - Functions: createRateLimiter, getSharedRateLimiter, resetSharedRateLimiter, withRateLimit, executeWithRateLimit
  - Types: RateLimiterConfig, RateLimiterStats
- Created tests/api/gamma/rate-limiter.test.ts with 40+ test cases covering:
  - Constructor and configuration (default and custom)
  - acquire() token consumption, queuing, queue full error, timeout
  - tryAcquire() non-blocking acquisition
  - Token refill behavior (rate, interval, max cap)
  - handleRateLimitResponse() with Response, number, Retry-After header
  - Exponential backoff calculation with jitter
  - pause() and resume() functionality
  - Statistics tracking and reset
  - reset() and dispose() cleanup
  - createRateLimiter() factory
  - Shared rate limiter singleton
  - withRateLimit() function decorator
  - executeWithRateLimit() automatic 429 retry
  - RateLimiterError class properties
- TypeScript typecheck passes (tsc --noEmit)
- NOTE: Tests require Node.js 20+ to run (vitest uses modern regex features)

COMPLETED: API-GAMMA-012 - Gamma API error handler
- Created src/api/gamma/error-handler.ts with comprehensive error handling:
  - ErrorHandler class with configurable retry logic
  - GammaErrorType enum: NETWORK, TIMEOUT, SERVER, RATE_LIMIT, AUTH, CLIENT, PARSE, UNKNOWN
  - ErrorSeverity enum: INFO, WARN, ERROR, CRITICAL
  - classifyError(): Classify errors by type and severity (handles GammaApiException and standard errors)
  - calculateBackoffDelay(): Exponential backoff with configurable jitter
  - shouldRetry(): Determine if error should be retried based on type and attempt count
  - createErrorContext(): Create detailed error context for logging and callbacks
  - logError(): Log errors with appropriate severity levels
- ErrorHandler class features:
  - execute(): Execute async function with retry logic, returns ErrorHandlerResult
  - executeOrThrow(): Execute and throw on failure (convenience method)
  - wrap(): Wrap async function with error handling
  - wrapOrThrow(): Wrap function that throws on failure
  - Configurable: maxRetries (default: 3), baseDelay (default: 1000ms), maxDelay (default: 30000ms)
  - Jitter support to prevent thundering herd
  - Custom logger injection
  - onError and onMaxRetriesExceeded callbacks
- Retry conditions:
  - Retryable by default: SERVER (5xx), RATE_LIMIT (429), NETWORK, TIMEOUT
  - Non-retryable: AUTH (401/403), CLIENT (4xx), PARSE errors
  - Configurable via retryableErrors option
- Helper functions:
  - createErrorHandler(): Factory for custom handlers
  - getSharedErrorHandler(): Singleton for shared use
  - resetSharedErrorHandler(), setSharedErrorHandler(): Manage shared instance
  - withErrorHandling(): Convenience wrapper using shared handler
  - withErrorHandlingOrThrow(): Convenience wrapper that throws on failure
- Updated src/api/gamma/index.ts exports:
  - Classes: ErrorHandler
  - Enums: GammaErrorType, ErrorSeverity
  - Functions: classifyError, calculateBackoffDelay, shouldRetry, createErrorContext, logError,
               createErrorHandler, getSharedErrorHandler, resetSharedErrorHandler,
               setSharedErrorHandler, withErrorHandling, withErrorHandlingOrThrow
  - Types: ErrorHandlerConfig, ErrorLogger, ErrorContext, ErrorHandlerResult, WrapWithErrorHandlingOptions
- Created tests/api/gamma/error-handler.test.ts with 50+ comprehensive tests covering:
  - classifyError for GammaApiException (429, 401, 403, 500, 502, 503, 400, 404)
  - classifyError for standard errors (timeout, network, parse, unknown)
  - calculateBackoffDelay (exponential, jitter, max cap)
  - shouldRetry (retryable errors, non-retryable, custom list)
  - createErrorContext (all fields, options, willRetry logic)
  - logError (severity levels, enableLogging flag)
  - ErrorHandler constructor, execute, executeOrThrow, wrap, wrapOrThrow
  - Retry behavior with fake timers
  - onError and onMaxRetriesExceeded callbacks
  - Shared error handler singleton
  - withErrorHandling and withErrorHandlingOrThrow convenience functions
  - Enum value verification
- TypeScript typecheck passes (tsc --noEmit)
- NOTE: Tests require Node.js 20+ to run (vitest uses modern regex features)

COMPLETED: API-GAMMA-013 - Gamma API response caching
- Created src/api/gamma/cache.ts with comprehensive caching implementation:
  - ResponseCache class with in-memory storage using Map
  - TTL (Time-To-Live) configuration per entry or default (60s)
  - Maximum entries limit with LRU eviction (default: 1000)
  - Automatic cleanup interval for expired entries
  - Tag-based invalidation support
  - Pattern-based invalidation (glob-like with *)
  - Cache hit/miss tracking and statistics
  - Memory usage estimation
- Cache configuration options:
  - defaultTTL: Default time-to-live in milliseconds
  - maxEntries: Maximum cache size with LRU eviction
  - enableLogging: Toggle cache hit/miss logging
  - logger: Custom logger injection
  - cleanupInterval: Auto-cleanup interval (0 to disable)
- CacheEntry structure includes:
  - value: The cached data
  - createdAt/expiresAt: Timestamps
  - hitCount: Access tracking
  - ttl: Entry-specific TTL
  - tags: For grouped invalidation
- Cache operations:
  - get<T>(key): Retrieve cached value
  - set<T>(key, value, options): Store value with optional TTL/tags
  - has(key): Check if key exists and is valid
  - delete/invalidate(key): Remove specific key
  - invalidateByTag(tag): Remove all entries with tag
  - invalidateByPattern(pattern): Remove by glob pattern
  - getOrFetch<T>(key, fetchFn, options): Get cached or fetch and cache
  - getOrFetchSync<T>(key, fetchFn, options): Synchronous version
  - cleanup(): Remove expired entries
  - clear(): Remove all entries
  - getStats(): Get cache statistics (hits, misses, hitRate, etc.)
- Helper utilities:
  - createCache(): Factory function
  - getSharedCache/resetSharedCache/setSharedCache: Singleton management
  - CacheTTL: Predefined TTL constants (SHORT, DEFAULT, MEDIUM, LONG, VERY_LONG, DAY)
  - CacheKeyPrefix: Standard key prefixes (MARKET, MARKETS, OUTCOMES, etc.)
  - Key generators: marketCacheKey, activeMarketsCacheKey, trendingMarketsCacheKey, etc.
  - withCache/withSharedCache: Function decorators for automatic caching
- Updated src/api/gamma/index.ts with all new exports
- Created tests/api/gamma/cache.test.ts with 60+ test cases covering:
  - Constructor and configuration
  - get/set operations with TTL
  - Cache expiration behavior
  - Hit count tracking
  - Tag storage and retrieval
  - refreshOnHit option
  - has() method
  - delete/invalidate methods
  - invalidateByTag functionality
  - invalidateByPattern with wildcards
  - getOrFetch async caching
  - getOrFetchSync synchronous caching
  - LRU eviction on max size
  - cleanup of expired entries
  - Statistics tracking (hits, misses, hitRate, evictions, expirations)
  - Memory usage estimation
  - Keys and size properties
  - Entry metadata retrieval
  - Custom logger support
  - dispose cleanup
  - createCache factory
  - Shared cache singleton
  - CacheTTL and CacheKeyPrefix constants
  - All key generator functions
  - withCache decorator
  - withSharedCache decorator
  - Automatic cleanup interval
  - Edge cases (null, undefined, complex objects, special chars)
- Implementation follows established patterns from rate-limiter and error-handler

COMPLETED: API-CLOB-001 - CLOB API client initialization
- Created src/api/clob/client.ts with ClobClient class for interacting with Polymarket CLOB API
- Created src/api/clob/types.ts with comprehensive type definitions:
  - ClobClientConfig: Client configuration options (baseUrl, apiKey, apiSecret, apiPassphrase, timeout, retries)
  - ClobRequestOptions: Request options with requiresAuth support
  - ClobApiError: Error response type
  - OrderSide, OrderType, OrderStatus, TradeDirection: Trading enums
  - Order, OrderBookLevel, OrderBook: Order book types
  - Trade, TradeExecution: Trade types
  - TradeFilter, TradesResponse: Query filter and response types
  - ClobCredentials, SignedHeaders: Authentication types
  - ClobMarket, TickSize, OrderBookDepth: Market info types
- Created src/api/clob/index.ts exporting all types and classes
- ClobClient class features:
  - Uses native fetch API (consistent with GammaClient)
  - Default configuration: baseUrl="https://clob.polymarket.com", timeout=30s, retries=3
  - Support for both public and authenticated endpoints
  - HMAC-SHA256 signature generation for authenticated requests using Web Crypto API
  - Automatic retry logic with exponential backoff
  - Retries on 5xx errors and 429 rate limits
  - Does not retry on 4xx client errors (except 429)
  - Custom ClobApiException class for typed error handling
  - get, post, put, delete convenience methods
  - generateAuthHeaders() for creating signed request headers
  - hasCredentials(), hasApiKey(), getCredentials() helper methods
  - Singleton clobClient export for convenience
  - createClobClient() factory function for custom instances
  - validateCredentials() helper to test API credentials
- Created tests/api/clob/client.test.ts with 45+ test cases covering:
  - Constructor and configuration (defaults, custom, partial overrides)
  - Credentials handling (hasCredentials, hasApiKey, getCredentials)
  - Factory function and singleton
  - GET, POST, PUT, DELETE requests
  - Authentication headers generation (POLY-API-KEY, POLY-SIGNATURE, POLY-TIMESTAMP, POLY-PASSPHRASE)
  - Error handling (4xx, 5xx, network errors, non-JSON responses)
  - Retry behavior (429 retry, 5xx retry, no retry on 4xx)
  - validateCredentials helper
  - Custom headers merging
  - Timeout handling
- Verified: TypeScript typecheck (tsc --noEmit) passes with no errors
- NOTE: Tests require Node 20+ to run (vitest uses modern regex features)
- Next up: API-CLOB-002

COMPLETED: API-CLOB-002 - Fetch order book for market
- Created src/api/clob/orderbook.ts with comprehensive order book functions:
  - getOrderBook(tokenId, options): Fetch order book for a specific token/market
  - getOrderBooks(tokenIds, options): Fetch multiple order books in parallel
  - calculateLiquidityAtPrice(): Calculate liquidity at a given price threshold
  - getMidPrice(): Calculate mid price between best bid and ask
  - getSpreadPercentage(): Calculate bid-ask spread as percentage
  - getTotalBidVolume(): Sum all bid volumes
  - getTotalAskVolume(): Sum all ask volumes
  - getVolumeImbalance(): Calculate volume imbalance ratio (bid/ask)
- Features:
  - Parses both array format [price, size] and object format {price, size}
  - Sorts bids descending (highest price first) and asks ascending (lowest price first)
  - Calculates best_bid, best_ask, and spread automatically
  - Handles various timestamp formats (ISO, Unix seconds, Unix milliseconds)
  - Returns null for 404 (market not found), throws on other errors
  - URL encodes token ID for safe API requests
  - Supports custom ClobClient injection for testing
- Updated src/api/clob/index.ts to export all new functions and types
- Created tests/api/clob/orderbook.test.ts with 40+ test cases covering:
  - Basic order book fetching
  - Bid/ask sorting verification
  - Best bid/ask calculation
  - Spread calculation
  - Object and array format parsing
  - Empty order book handling
  - Invalid token ID handling (empty, whitespace)
  - 404 and error handling
  - URL encoding
  - Timestamp parsing (Unix seconds, milliseconds, ISO)
  - Asset ID fallback logic
  - Multiple order book fetching
  - Liquidity calculation
  - Mid price and spread percentage calculation
  - Volume calculations and imbalance
- Verified: TypeScript typecheck (tsc --noEmit) passes with no errors
- NOTE: Tests require Node 20+ to run (vitest uses modern regex features)
- Next up: API-CLOB-003

COMPLETED: API-CLOB-003 - Fetch recent trades
- Created src/api/clob/trades.ts with comprehensive trade functions:
  - getRecentTrades(tokenId, options): Fetch recent trades for a specific token/market
  - getRecentTradesForTokens(tokenIds, options): Fetch trades for multiple tokens in parallel
  - calculateTotalVolume(trades): Calculate total volume from trades array
  - calculateVWAP(trades): Calculate volume-weighted average price
  - getPriceRange(trades): Get min/max prices from trades
  - getTradeCounts(trades): Count trades by side (buy/sell)
  - getVolumesBySide(trades): Calculate volumes by side
  - filterTradesByTimeRange(): Filter trades within a time range
  - filterTradesByMinSize(): Filter trades above a minimum size
  - getUniqueWallets(): Extract unique taker/maker wallet addresses
- Features:
  - Parses multiple API response formats (array, trades field, data field)
  - Handles alternative field names (trade_id, amount, taker, maker, tx_hash, etc.)
  - Parses trade direction from various formats (buy, sell, BUY, SELL, s, ask)
  - Handles timestamps in ISO, Unix seconds, and Unix milliseconds formats
  - Sorts trades by timestamp descending (most recent first)
  - Configurable limit parameter (clamped between 1 and 1000)
  - Returns null for 404 (market not found), throws on other errors
  - URL encodes token ID for safe API requests
  - Supports custom ClobClient injection for testing
- Updated src/api/clob/index.ts to export all new functions and types
- Created tests/api/clob/trades.test.ts with 40+ test cases covering:
  - Basic trade fetching and parsing
  - Timestamp sorting verification
  - Multiple API response formats (array, trades, data)
  - Alternative field name handling
  - Unix timestamp parsing (seconds and milliseconds)
  - Limit parameter handling (clamping, API query string)
  - Invalid/empty token ID handling
  - 404 and error handling
  - URL encoding
  - Trade direction parsing
  - Match ID and bucket index handling
  - Multiple token fetching in parallel
  - All helper functions (volume, VWAP, price range, counts, filtering)
  - Unique wallet extraction
- Verified: TypeScript typecheck (tsc --noEmit) passes with no errors
- NOTE: Tests require Node 20+ to run (vitest uses modern regex features)
- Next up: API-CLOB-004

COMPLETED: API-CLOB-004 - Fetch trades by wallet address
- Extended src/api/clob/trades.ts with comprehensive wallet trade functions:
  - getTradesByWallet(walletAddress, options): Fetch trades for a specific wallet
  - getAllTradesByWallet(walletAddress, options): Fetch all trades with automatic pagination
  - getWalletActivitySummary(trades, walletAddress): Get activity summary for wallet
  - hasWalletTraded(walletAddress, options): Check if wallet has any trading history
  - getFirstWalletTrade(walletAddress, options): Get oldest trade for wallet
  - getTradesBetweenWallets(walletA, walletB, options): Find trades between two wallets
  - isValidWalletAddress(address): Validate Ethereum address format
  - normalizeWalletAddress(address): Normalize address (lowercase, trimmed)
- Features:
  - Validates Ethereum wallet address format (0x + 40 hex characters)
  - Supports role filtering: "maker", "taker", or "both"
  - Token ID filtering for specific market trades
  - Time range filtering with startTime/endTime
  - Pagination support with cursor-based navigation
  - Case-insensitive address matching
  - Automatic pagination in getAllTradesByWallet with safety limits
  - WalletActivitySummary includes: totalTrades, tradesAsMaker/tradesAsTaker,
    volumeAsMaker/volumeAsTaker, buyTrades/sellTrades, uniqueTokens, timestamps
  - Returns null for invalid addresses (no API call made)
  - Returns empty result for 404 responses (wallet has no trades)
  - Throws ClobApiException for server errors
  - Custom ClobClient injection for testing
- Added new types:
  - WalletTradeRole: "maker" | "taker" | "both"
  - GetTradesByWalletOptions: limit, cursor, role, tokenId, startTime, endTime, client
  - GetTradesByWalletResult: trades, count, walletAddress, role, nextCursor, hasMore, fetchedAt
  - WalletActivitySummary: comprehensive wallet trading statistics
- Updated src/api/clob/index.ts to export all new functions and types
- Created comprehensive tests in tests/api/clob/trades.test.ts (40+ new test cases):
  - isValidWalletAddress tests (valid/invalid addresses, whitespace, null/undefined)
  - normalizeWalletAddress tests
  - getTradesByWallet tests (basic fetch, role filtering, pagination, time filters,
    error handling, address normalization, sorting, limit parameter)
  - getAllTradesByWallet tests (pagination, maxTrades limit, invalid addresses)
  - getWalletActivitySummary tests (summary calculation, empty array, invalid sizes)
  - hasWalletTraded tests (true/false cases, invalid address)
  - getFirstWalletTrade tests (oldest trade, no trades, invalid address)
  - getTradesBetweenWallets tests (find trades, invalid addresses, same wallet, no trades)
- NOTE: Tests require Node 20+ to run (vitest uses modern regex features)
- Next up: API-CLOB-005

=== Session 2026-01-10 ===

COMPLETED: API-CLOB-005 - Fetch open orders by wallet
- Created src/api/clob/orders.ts with comprehensive order management functions:
  - getOpenOrders(walletAddress, options): Fetch open orders for a specific wallet
  - getAllOpenOrders(walletAddress, options): Fetch all orders with automatic pagination
  - getOpenOrdersSummary(orders, walletAddress): Calculate aggregate statistics
  - hasOpenOrders(walletAddress, options): Check if wallet has any open orders
  - getOpenOrdersForMarket(walletAddress, tokenId, options): Fetch orders for specific market
  - calculateOpenOrdersValue(orders): Calculate total value of open orders
  - calculateRemainingOrdersValue(orders): Calculate unfilled value
  - getOrderRemainingSize(order): Get remaining size to be filled
  - getOrderFillPercentage(order): Get fill percentage (0-100)
  - filterOrdersByMinRemainingSize(orders, minSize): Filter by minimum remaining size
  - groupOrdersByToken(orders): Group orders by token/asset ID
  - groupOrdersBySide(orders): Group orders by side (BUY/SELL)
- Added types:
  - GetOpenOrdersOptions: limit, cursor, tokenId, assetId, side, client
  - GetOpenOrdersResult: orders, count, walletAddress, tokenId, nextCursor, hasMore, fetchedAt
  - OpenOrdersSummary: comprehensive wallet order statistics
- Features:
  - Validates Ethereum wallet address format
  - Pagination support with cursor-based navigation
  - Token ID filtering for specific market orders
  - Side filtering (BUY/SELL)
  - Client-side sorting by creation time descending
  - Client-side filtering for open/live orders
  - Safety limits (maxOrders, maxPages)
  - Custom ClobClient injection for testing
  - Returns null for invalid addresses
  - Returns empty result for 404 responses
- Updated src/api/clob/index.ts to export all new functions and types
- Created comprehensive tests in tests/api/clob/orders.test.ts (65 test cases):
  - getOpenOrders tests (basic fetch, validation, query params, pagination, filtering,
    sorting, error handling, authentication)
  - getAllOpenOrders tests (pagination, maxOrders limit, empty results)
  - getOpenOrdersSummary tests (summary calculation, empty array, invalid values)
  - hasOpenOrders tests (true/false cases, invalid address)
  - getOpenOrdersForMarket tests (specific market, empty tokenId)
  - Helper function tests (calculateOpenOrdersValue, calculateRemainingOrdersValue,
    getOrderRemainingSize, getOrderFillPercentage, filterOrdersByMinRemainingSize,
    groupOrdersByToken, groupOrdersBySide)
- Fixed pre-existing test failures:
  - Fixed orders.test.ts: Updated getAllOpenOrders empty results test (returns [] not null)
  - Fixed trades.test.ts: Updated Unix timestamp constants (1768003200 for 2026-01-10)
  - Fixed rate-limiter.test.ts: Updated error message assertion and added promise catch
- All 678 tests pass
- TypeScript typecheck passes
- E2E browser test passes (app loads correctly at localhost:3000)
- Next up: API-CLOB-006

COMPLETED: API-CLOB-006 - Fetch trade history with filters
- Added comprehensive filtered trades functionality to src/api/clob/trades.ts:
  - getFilteredTrades(options): Fetch trades with server-side and client-side filters
  - getAllFilteredTrades(options): Fetch all matching trades with automatic pagination
  - calculateFilteredTradesStats(trades): Calculate statistics for filtered trades
  - getTradesInTimeWindow(startTime, endTime, options): Convenience for time-range queries
  - getLargeTrades(tokenId, minSize, options): Find whale trades above a size threshold
  - getTradesInPriceRange(minPrice, maxPrice, options): Find trades in a price range
  - getTradesBySide(side, options): Filter buy or sell trades only
- Added types:
  - TradeFilterOptions: startTime, endTime, minSize, maxSize, minPrice, maxPrice,
    side, tokenId, makerAddress, takerAddress, limit, cursor, sortOrder, client
  - GetFilteredTradesResult: trades, count, filters, nextCursor, hasMore, fetchedAt
  - FilteredTradesStats: totalTrades, totalVolume, totalValue, avgSize, avgPrice,
    vwap, minSize, maxSize, minPrice, maxPrice, buyCount, sellCount, buyVolume,
    sellVolume, earliestTrade, latestTrade
- Features:
  - Server-side query parameter building for API efficiency
  - Client-side filtering as fallback for APIs that don't support all parameters
  - Date range filtering (startTime/endTime with ISO strings or Date objects)
  - Size filtering (minSize/maxSize)
  - Price filtering (minPrice/maxPrice)
  - Side filtering (buy/sell)
  - Maker/taker address filtering with validation
  - Ascending/descending sort order support
  - Pagination support with cursor navigation
  - VWAP calculation in statistics
  - Comprehensive input validation
- Updated src/api/clob/index.ts with new exports
- Added 30 test cases for filtered trades functionality:
  - getFilteredTrades tests (filters, date range, size, price, side, maker address,
    invalid addresses, pagination, sort order, error handling, limit clamping)
  - getAllFilteredTrades tests (pagination, maxTrades limit)
  - calculateFilteredTradesStats tests (statistics, empty array, VWAP)
  - getTradesInTimeWindow tests
  - getLargeTrades tests (size threshold, invalid inputs)
  - getTradesInPriceRange tests (price range, invalid inputs)
  - getTradesBySide tests (buy/sell filtering)
- All 708 tests pass
- TypeScript typecheck passes
- E2E browser test passes
- Next up: API-CLOB-007

COMPLETED: API-CLOB-007 - Fetch order book depth
- Extended src/api/clob/orderbook.ts with comprehensive order book depth functions:
  - getOrderBookDepth(tokenId, options): Fetch order book depth with aggregated price levels
  - getCumulativeVolumeAtPrice(depth, side, price): Get cumulative volume at a price level
  - getPriceForVolume(depth, side, volume): Get price needed to fill a specific volume
  - calculateMarketImpact(depth, side, volume): Calculate average execution price for volume
  - getDepthAtPercentages(depth, percentages): Get depth at multiple % from mid price
  - checkLiquidity(depth, side, volume, maxSlippage): Check if liquidity is sufficient
- Added types:
  - OrderBookDepthLevel: price, size, cumulativeSize, cumulativeValue, orderCount, percentOfTotal
  - GetOrderBookDepthOptions: levels, priceInterval, maxDepthPercent, client
  - DepthSideSummary: totalVolume, totalValue, weightedAvgPrice, levelCount, bestPrice, worstPrice, priceRange
  - OrderBookDepth: tokenId, bidDepth, askDepth, bidSummary, askSummary, midPrice, spread, spreadPercent, volumeImbalance, timestamp
- Features:
  - Price aggregation by configurable intervals (e.g., 0.01, 0.001)
  - Automatic price interval calculation based on spread
  - Bids rounded down, asks rounded up for proper aggregation
  - Cumulative volume and value calculation per level
  - Order count tracking per aggregated level
  - Percentage of total volume per level
  - Depth summary statistics (weighted avg price, price range, etc.)
  - Max depth percentage filtering (e.g., only levels within 10% of best price)
  - Mid price, spread, and spread percentage calculation
  - Volume imbalance ratio between bids and asks
  - Market impact calculation for slippage analysis
  - Liquidity sufficiency checking with max slippage tolerance
- Updated src/api/clob/index.ts with new exports
- Added 25+ test cases for order book depth functionality:
  - getOrderBookDepth tests (basic fetch, price aggregation, cumulative calculation,
    levels limit, auto interval, max depth filter, mid price, spread, imbalance)
  - getCumulativeVolumeAtPrice tests (bid/ask cumulative volumes)
  - getPriceForVolume tests (fillable price calculation, insufficient liquidity)
  - calculateMarketImpact tests (average price for volume, multi-level spans)
  - getDepthAtPercentages tests (depth at multiple percentages from mid)
  - checkLiquidity tests (sufficient, insufficient, slippage exceeds max)
- All 731 tests pass
- TypeScript typecheck passes
- E2E browser test passes
- Created scripts/browser-smoke-test.mjs for automated E2E testing

COMPLETED: API-CLOB-008 - CLOB API authentication
- Created src/api/clob/auth.ts with comprehensive authentication functionality:
  - generateSignature(): HMAC-SHA256 signature generation for API authentication
  - generateAuthHeaders(): Generate full auth header set (POLY-API-KEY, POLY-SIGNATURE, POLY-TIMESTAMP, POLY-PASSPHRASE)
  - validateCredentialFormat(): Validate API key and secret format
  - AuthErrorType enum: 11 authentication error types for classified error handling
    - MISSING_CREDENTIALS, INVALID_KEY_FORMAT, KEY_REVOKED, KEY_EXPIRED
    - INVALID_SIGNATURE, TIMESTAMP_EXPIRED, INVALID_PASSPHRASE
    - IP_NOT_WHITELISTED, RATE_LIMITED, PERMISSION_DENIED, UNKNOWN
  - classifyAuthError(): Classify errors by type, message, and suggested action
  - isAuthError(), isRetryableAuthError(): Error type checking helpers
  - ClassifiedAuthError interface: type, message, statusCode, retryable, suggestedAction, originalCode
- Credential Storage features:
  - CredentialStore class: Secure in-memory credential storage
  - Optional XOR encryption for in-memory obfuscation
  - Environment variable loading support (POLY_API_KEY, POLY_API_SECRET, POLY_API_PASSPHRASE)
  - Custom env var prefix configuration
  - Credentials age tracking
  - Masked credentials for display
- Key Rotation support:
  - AuthManager class: Full authentication state management
  - KeyRotationConfig: maxCredentialAge, maxAuthFailures, onRotationNeeded callback
  - Automatic rotation detection based on consecutive failures or credential age
  - rotateCredentials(): Trigger rotation with callback support
  - AuthState tracking: hasCredentials, credentialsSetAt, authFailures, lastSuccessfulAuth, lastFailedAuth, lastError
- Singleton management:
  - getSharedAuthManager(), setSharedAuthManager(), resetSharedAuthManager()
  - createAuthManager() factory function
- Auth wrapper:
  - withAuth(): Execute function with auto-generated auth headers
  - Automatic success/failure recording
  - Automatic rotation attempt on failures
- Updated src/api/clob/index.ts with all new exports:
  - Functions: generateSignature, generateAuthHeaders, validateCredentialFormat, classifyAuthError,
    isAuthError, isRetryableAuthError, withAuth, getSharedAuthManager, setSharedAuthManager,
    resetSharedAuthManager, createAuthManager
  - Classes: CredentialStore, AuthManager
  - Enum: AuthErrorType
  - Types: ClassifiedAuthError, CredentialStorageConfig, KeyRotationConfig, AuthState
- Created comprehensive tests in tests/api/clob/auth.test.ts with 80 test cases covering:
  - generateSignature tests (base64 encoding, different inputs, consistency)
  - generateAuthHeaders tests (header generation, passphrase handling, validation)
  - validateCredentialFormat tests (valid/invalid credentials, format checks)
  - classifyAuthError tests (all error types, status codes, retryable determination)
  - isAuthError and isRetryableAuthError tests
  - CredentialStore tests (storage, encryption, env vars, masking, age tracking)
  - AuthManager tests (credential management, header generation, state tracking, rotation)
  - Shared AuthManager singleton tests
  - withAuth wrapper tests (success/failure recording, rotation attempts)
  - AuthErrorType enum validation
- All 811 tests pass (80 new tests added)
- TypeScript typecheck passes
- App loads correctly at localhost:3000
- Next up: API-CLOB-009

COMPLETED: API-CLOB-009 - CLOB API rate limiter
- Created src/api/clob/rate-limiter.ts with comprehensive rate limiting implementation:
  - ClobRateLimiter class with per-endpoint category rate limiting
  - ClobEndpointCategory enum: PUBLIC, PRIVATE, TRADING, HISTORICAL
  - Different default rate limits per category:
    - PUBLIC: 20 burst, 5/sec sustained (for order books, trades, markets)
    - PRIVATE: 10 burst, 2/sec sustained (for orders, positions, account)
    - TRADING: 5 burst, 1/sec sustained (for order placement/cancel/amend)
    - HISTORICAL: 10 burst, 2/sec sustained (for historical queries)
  - Reuses token bucket algorithm from Gamma rate limiter
  - Configurable category limits via ClobRateLimiterConfig
  - Optional shared limiter across categories
  - Integration with Gamma shared limiter (useGammaSharedLimiter option)
  - Logging support with custom logger injection
  - Endpoint category detection via getEndpointCategory() function
  - Pattern matching for endpoint categorization
  - Singleton management: getSharedClobRateLimiter, setSharedClobRateLimiter, resetSharedClobRateLimiter
  - createClobRateLimiter factory function
  - withClobRateLimit decorator for wrapping functions
  - executeWithClobRateLimit for automatic 429 retry with rate limiting
  - Per-category stats: tokens, queue, paused state
  - Aggregated stats with most constrained category detection
  - Category-level pause/resume/reset operations
  - Full dispose with cleanup
- Updated src/api/clob/index.ts with all new exports
- Created tests/api/clob/rate-limiter.test.ts with 81 comprehensive tests:
  - ClobRateLimiter constructor tests (defaults, custom limits, logging, shared limiter)
  - getCategoryLimiter tests
  - acquire tests (all categories, shared limiter interaction, unknown category error)
  - tryAcquire tests (immediate acquisition, shared limiter blocking)
  - handleRateLimitResponse tests (429 handling, Retry-After header, shared limiter)
  - getStats tests (all categories, total tracking, most constrained detection)
  - getCategoryStats tests
  - logStatus tests
  - resetStats, resetCategory, reset tests
  - pauseCategory, resumeCategory, isCategoryPaused tests
  - dispose tests
  - getEndpointCategory tests:
    - Trading: /order, /orders/cancel, /orders/amend
    - Private: /orders, /positions, /account, /balances, /auth
    - Historical: trades with maker/taker/start_ts filters, history endpoints
    - Public: /book, /trades, /markets, /price, /midpoint
    - Full URLs with host and port
  - Shared CLOB rate limiter singleton tests
  - createClobRateLimiter factory tests
  - withClobRateLimit decorator tests
  - executeWithClobRateLimit tests (429 retry, max retries, non-rate-limit errors)
  - ClobEndpointCategory enum tests
  - RateLimiterError re-export tests
- All 892 tests pass (81 new tests added)
- TypeScript typecheck passes
- Browser smoke test passes
- App loads correctly at localhost:3000
- Next up: API-CLOB-010

COMPLETED: API-CLOB-010 - CLOB API error handler
- Created src/api/clob/error-handler.ts with comprehensive error handling:
  - ClobErrorType enum with 19 CLOB-specific error types:
    - NETWORK, TIMEOUT, SERVER, RATE_LIMIT (common errors)
    - AUTH, FORBIDDEN (authentication/authorization errors)
    - NOT_FOUND, VALIDATION (resource and validation errors)
    - INSUFFICIENT_BALANCE, DUPLICATE_ORDER, ORDER_NOT_FOUND (order-specific)
    - MARKET_CLOSED, NONCE_ERROR, SIGNATURE_ERROR (trading errors)
    - INVALID_PRICE, INVALID_SIZE (validation errors)
    - PARSE, CLIENT, UNKNOWN (general errors)
  - ClobErrorSeverity enum: INFO, WARN, ERROR, CRITICAL
  - ClobErrorCodes constants for all known CLOB API error codes:
    - Authentication: MISSING_CREDENTIALS, INVALID_API_KEY, INVALID_SIGNATURE, EXPIRED_TIMESTAMP
    - Order: ORDER_NOT_FOUND, DUPLICATE_ORDER, ORDER_ALREADY_FILLED, ORDER_ALREADY_CANCELLED
    - Balance: INSUFFICIENT_BALANCE, INSUFFICIENT_ALLOWANCE
    - Validation: INVALID_PRICE, INVALID_SIZE, SIZE_TOO_SMALL, SIZE_TOO_LARGE
    - Market: MARKET_NOT_FOUND, MARKET_CLOSED, MARKET_PAUSED, MARKET_NOT_TRADEABLE
    - Nonce: INVALID_NONCE, NONCE_TOO_LOW, NONCE_ALREADY_USED
    - Rate: RATE_LIMITED, TOO_MANY_REQUESTS
    - Server: INTERNAL_ERROR, SERVICE_UNAVAILABLE
  - RecoveryAction enum for automated recovery:
    - NONE, REFRESH_AUTH, WAIT_RATE_LIMIT, REFRESH_NONCE
    - RESIGN_REQUEST, REFRESH_BALANCE, REFRESH_MARKET, RESUBMIT_ORDER
- Error classification functions:
  - classifyClobError(): Classify ClobApiException and standard errors by type, severity, status code
  - getRecoveryAction(): Get suggested recovery action for error type
  - Error code mapping for all known CLOB error codes
  - Message pattern matching for common error scenarios
  - getSeverityForType(): Map error types to appropriate severity levels
- Backoff and retry logic:
  - calculateClobBackoffDelay(): Exponential backoff with jitter
  - shouldRetryClobError(): Check if error should be retried based on type and attempt count
  - Default retryable errors: SERVER, RATE_LIMIT, NETWORK, TIMEOUT, NONCE_ERROR
- Error context and logging:
  - createClobErrorContext(): Build comprehensive error context with all metadata
  - logClobError(): Log errors with appropriate severity levels
  - Context includes: errorType, severity, statusCode, errorCode, attempt, retryDelay, operation, tokenId, orderId, recoveryAction
  - formatClobErrorMessage(): Generate user-friendly error messages
- ClobErrorHandler class:
  - execute<T>(): Execute async function with retry logic, returns ClobErrorHandlerResult
  - executeOrThrow<T>(): Execute and throw on failure
  - wrap(), wrapOrThrow(): Function decorators for automatic error handling
  - onError callback for error events
  - onMaxRetriesExceeded callback for retry exhaustion
  - onRecoverableError callback for recovery attempts
  - Recovery flow: call recovery handler, retry if recovery succeeds
- Type checking helpers:
  - isClobErrorType(): Check if error is specific type(s)
  - isRetryableClobError(): Check if error is retryable by default
  - hasRecoveryAction(): Check if error has a recovery action
- Singleton management:
  - createClobErrorHandler(), getSharedClobErrorHandler()
  - setSharedClobErrorHandler(), resetSharedClobErrorHandler()
- Convenience wrappers:
  - withClobErrorHandling(): Use shared handler for single operations
  - withClobErrorHandlingOrThrow(): Use shared handler, throw on failure
- Updated src/api/clob/index.ts with all new exports:
  - Enums: ClobErrorType, ClobErrorSeverity, ClobErrorCodes, RecoveryAction
  - Functions: classifyClobError, getRecoveryAction, calculateClobBackoffDelay, shouldRetryClobError,
    createClobErrorContext, logClobError, isClobErrorType, isRetryableClobError, hasRecoveryAction,
    createClobErrorHandler, getSharedClobErrorHandler, resetSharedClobErrorHandler, setSharedClobErrorHandler,
    withClobErrorHandling, withClobErrorHandlingOrThrow, formatClobErrorMessage
  - Class: ClobErrorHandler
  - Types: ClobErrorCode, ClobErrorHandlerConfig, ClobErrorLogger, ClobErrorContext, ClobErrorHandlerResult, ClobWrapOptions
- Created tests/api/clob/error-handler.test.ts with 111 comprehensive tests:
  - Enum value verification (ClobErrorType, ClobErrorSeverity, ClobErrorCodes, RecoveryAction)
  - ClobApiException classification (all status codes: 429, 401, 403, 404, 500, 502, 503, 400)
  - Error code classification (all known CLOB error codes)
  - Message-based classification (insufficient balance, order not found, market closed, nonce, signature, price, size, duplicate, rate limit)
  - Standard Error classification (timeout, AbortError, network, ECONNREFUSED, ENOTFOUND, fetch failed, JSON parse, SyntaxError, unknown)
  - Recovery action mapping for all error types
  - Backoff delay calculation (exponential, max cap, jitter)
  - shouldRetryClobError logic (retryable, max retries, custom list)
  - createClobErrorContext (all fields, willRetry, recovery action)
  - logClobError (severity levels, enableLogging, operation in message, tokenId/orderId in data)
  - Type checking helpers (isClobErrorType, isRetryableClobError, hasRecoveryAction)
  - ClobErrorHandler constructor (default config, custom config, custom logger)
  - execute (success, non-retryable failure, retry on retryable, fail after max retries)
  - Callbacks (onError, onMaxRetriesExceeded, onRecoverableError)
  - Recovery flow (retry after successful recovery)
  - executeOrThrow, wrap, wrapOrThrow methods
  - createClobErrorHandler factory
  - Shared handler singleton tests
  - withClobErrorHandling and withClobErrorHandlingOrThrow
  - formatClobErrorMessage for all error types
- All 1003 tests pass (111 new tests added)
- TypeScript typecheck passes
- Browser smoke test passes
- App loads correctly at localhost:3000

COMPLETED: API-CLOB-011 - Parse trade execution data
- Created src/api/clob/trade-execution.ts with comprehensive trade execution parsing:
  - parseTradeExecution(): Parse raw API response into EnrichedTradeExecution
  - tradeToExecution(): Convert Trade object to EnrichedTradeExecution
  - parseTradeExecutions(): Batch parse with error handling and statistics
  - tradesToExecutions(): Convert Trade[] to executions with summary
- Timestamp normalization functions:
  - parseTimestampToMs(): Parse various formats (ISO, Unix seconds, Unix milliseconds, Date)
  - normalizeTimestamp(): Returns NormalizedTimestamp with iso, date, unix, unixMs, formatted, relative
  - isTimestampInRange(): Check if timestamp is within a time range
  - Handles edge cases: null, undefined, 0, future timestamps, invalid strings
- Fee extraction and calculation:
  - extractFeeRateBps(): Extract fee rate from raw data (multiple field names)
  - calculateFeeFromRate(): Calculate fee from rate and size
  - extractFeeUsd(): Extract or calculate fee in USD
  - calculateTotalFees(): Sum fees from array of executions
  - Supports: fee_usd, fee_amount, fee, trading_fee, fee_rate_bps fields
- Value extraction functions:
  - extractSizeUsd(): Extract USD value from multiple field variants
  - extractPrice(): Extract price from price or execution_price
  - extractSize(): Extract size from size, amount, or quantity
  - calculateFeeFromRate(): Calculate fee from basis points
  - Supports: size_usd, value_usd, usd_amount, notional fields
- Trade direction parsing:
  - parseTradeDirection(): Normalize side to "buy" or "sell"
  - Handles: buy, sell, BUY, SELL, b, s, bid, ask, long, short, offer
- Execution status determination:
  - determineExecutionStatus(): Returns ExecutionStatus enum
  - Values: "filled", "partial", "pending", "cancelled", "unknown"
  - Checks: status field, is_partial flag, is_fill flag, transaction_hash presence
- Type definitions:
  - RawTradeExecutionResponse: Handles various API field naming conventions
  - EnrichedTradeExecution: Extended TradeExecution with computed fields
    - net_value_usd: Calculated after fees
    - price_numeric, size_numeric: Parsed numeric values
    - fee_rate_bps_numeric: Fee rate as number
    - is_partial_fill: Boolean flag
    - execution_status: ExecutionStatus enum
    - executed_at: Date object
    - executed_at_ms: Unix timestamp in milliseconds
  - ExecutionStatus: "filled" | "partial" | "pending" | "cancelled" | "unknown"
  - FeeCalculationOptions: defaultFeeRateBps, usdcPrice
  - NormalizedTimestamp: Multiple timestamp formats
  - ParseTradeExecutionsResult: Batch parsing result with summary
- Utility functions:
  - sortExecutionsByTime(): Sort by timestamp (asc or desc)
  - filterExecutionsByTimeRange(): Filter by time range
  - filterExecutionsByMinSize(): Filter by minimum USD size
  - groupExecutionsByAsset(): Group by asset/token ID
  - groupExecutionsBySide(): Split into buy/sell arrays
  - calculateExecutionVWAP(): Volume-weighted average price
  - isEnrichedTradeExecution(): Type guard function
- Updated src/api/clob/index.ts with all new exports:
  - Functions: parseTradeExecution, tradeToExecution, parseTradeExecutions, tradesToExecutions,
    parseTimestampToMs, normalizeTimestamp, isTimestampInRange, extractFeeRateBps, calculateFeeFromRate,
    extractFeeUsd, calculateTotalFees, extractSizeUsd, extractPrice, extractSize, parseTradeDirection,
    determineExecutionStatus, sortExecutionsByTime, filterExecutionsByTimeRange, filterExecutionsByMinSize,
    groupExecutionsByAsset, groupExecutionsBySide, calculateExecutionVWAP, isEnrichedTradeExecution
  - Types: RawTradeExecutionResponse, EnrichedTradeExecution, ExecutionStatus, FeeCalculationOptions,
    NormalizedTimestamp, ParseTradeExecutionsResult
- Created tests/api/clob/trade-execution.test.ts with 114 comprehensive tests:
  - Timestamp normalization tests (parseTimestampToMs, normalizeTimestamp, isTimestampInRange)
    - ISO parsing, Unix seconds/milliseconds, Date objects, strings, null/undefined handling
  - Fee extraction tests (extractFeeRateBps, calculateFeeFromRate, extractFeeUsd, calculateTotalFees)
    - Multiple field names, default values, calculation from rate
  - Value extraction tests (extractSizeUsd, extractPrice, extractSize)
    - Multiple field variants, USDC price multiplier, calculation from price*size
  - Trade direction tests (parseTradeDirection)
    - All variants: buy, sell, BUY, SELL, b, s, bid, ask, long, short, offer
  - Execution status tests (determineExecutionStatus)
    - All status values, boolean flags, transaction hash inference
  - Main parsing tests (parseTradeExecution, tradeToExecution)
    - Full field parsing, net value calculation, alternative field names
    - Market metadata, partial fills, order ID
  - Batch parsing tests (parseTradeExecutions, tradesToExecutions)
    - Multiple trades, summary statistics, earliest/latest tracking
  - Utility function tests:
    - sortExecutionsByTime (ascending, descending, immutability)
    - filterExecutionsByTimeRange (inclusive start, exclusive end, null handling)
    - filterExecutionsByMinSize (USD threshold)
    - groupExecutionsByAsset, groupExecutionsBySide
    - calculateExecutionVWAP (weighted average, edge cases)
    - isEnrichedTradeExecution (type guard validation)
  - Edge case tests:
    - Minimal/empty data, invalid data, NaN handling
    - Negative values, very old timestamps, future timestamps, epoch
    - Large data sets (1000 trades)
  - Integration tests:
    - Complete workflow: parse, sort, filter, group, calculate
- All 1117 tests pass (114 new tests added)
- TypeScript typecheck passes
- Browser smoke test passes
- App loads correctly at localhost:3000
- Next up: API-CLOB-012

COMPLETED: API-CLOB-012 - Calculate trade sizes in USD
- Created src/api/clob/usd-calculator.ts with comprehensive USD calculation functionality:
  - USDC price handling: getUsdcPrice, validateUsdcPrice, createUsdcPriceFetcher
  - Trade size calculations: calculateTradeSizeUsd, calculateTradeValueWithFees
  - Trade USD value functions: calculateTradeUsdValues, calculateTradesUsdValues
  - Trade enrichment: enrichTradeWithUsd, enrichTradesWithUsd
  - Summary calculations: calculateTradeUsdSummary (with VWAP, volume by side, min/max)
  - Position value: calculatePositionValueUsd (with P&L tracking)
  - Profit calculations: calculatePotentialPayout, calculatePotentialProfit, calculatePotentialRoi
  - Outcome token pricing: getOutcomeTokenPrice, priceToImpliedProbability, impliedProbabilityToPrice
  - Order book USD: addUsdToOrderBookLevels, calculateOrderBookSideValueUsd, calculateOrderBookTotalValueUsd
  - Position tracking: buildPositionFromTrades (tracks avg cost, realized/unrealized P&L)
  - Utility functions: formatUsdValue, isWhaleTrade, filterTradesByMinValueUsd, sortTradesByValueUsd, getTopTradesByValue
- Types exported:
  - UsdCalculatorConfig: Configuration for USD calculations (usdcPrice, defaultFeeRateBps, includeFees)
  - PositionValueResult: Position value with optional P&L data
  - TradeWithUsdValues: Trade with calculated USD values
  - OrderBookLevelUsd: Order book level with USD value
  - TradeUsdSummary: Summary statistics for multiple trades
  - OutcomeTokenPrice: Outcome token pricing information
  - Position: Full position with cost basis and P&L tracking
- Features:
  - USDC price handling with validation and caching support
  - Price-to-probability and probability-to-price conversions
  - Support for string and number inputs throughout
  - Configurable fee rates in basis points
  - Cost basis tracking with realized/unrealized P&L
  - Whale trade detection with configurable threshold
  - Volume-weighted average price (VWAP) calculation
  - Compact USD formatting (K/M suffixes)
- Updated src/api/clob/index.ts with all new exports
- Created tests/api/clob/usd-calculator.test.ts with 83 comprehensive tests:
  - USDC price tests (getUsdcPrice, validateUsdcPrice, createUsdcPriceFetcher)
  - Trade size tests (calculateTradeSizeUsd, calculateTradeValueWithFees)
  - Trade USD value tests (calculateTradeUsdValues, calculateTradesUsdValues)
  - Trade enrichment tests (enrichTradeWithUsd, enrichTradesWithUsd)
  - Summary tests (calculateTradeUsdSummary with VWAP)
  - Position value tests (calculatePositionValueUsd with P&L)
  - Profit tests (calculatePotentialPayout, calculatePotentialProfit, calculatePotentialRoi)
  - Token pricing tests (getOutcomeTokenPrice, priceToImpliedProbability, impliedProbabilityToPrice)
  - Order book tests (addUsdToOrderBookLevels, calculateOrderBookSideValueUsd, calculateOrderBookTotalValueUsd)
  - Position tracking tests (buildPositionFromTrades)
  - Utility tests (formatUsdValue, isWhaleTrade, filterTradesByMinValueUsd, sortTradesByValueUsd, getTopTradesByValue)
- All 1200 tests pass (83 new tests added)
- TypeScript typecheck passes
- Browser smoke test passes
- App loads correctly at localhost:3000
- Next up: API-WS-001

COMPLETED: API-WS-001 - WebSocket connection manager
- Created src/api/ws/ directory structure for WebSocket functionality
- Created src/api/ws/types.ts with comprehensive type definitions:
  - ConnectionState: 6 states (disconnected, connecting, connected, reconnecting, disconnecting, error)
  - WebSocketConfig: Connection configuration (url, protocols, timeouts, reconnect settings)
  - WebSocketManagerConfig: Manager-level configuration (maxConnections, defaults)
  - Event types: ConnectionOpenEvent, ConnectionCloseEvent, ConnectionErrorEvent, MessageEvent, ReconnectEvent, StateChangeEvent
  - EventListenerMap: Type-safe event listener registration
  - ConnectionStats: Statistics tracking (messages sent/received, bytes, latency)
  - ConnectionInfo: Full connection information
  - IWebSocket: Interface for WebSocket abstraction (enables testing)
  - WebSocketConstructor: Constructor type for dependency injection
  - Constants: CloseCode (standard WebSocket close codes), WebSocketReadyState
- Created src/api/ws/connection-manager.ts with full implementation:
  - WebSocketConnection class:
    - Full connection lifecycle management (connect, disconnect)
    - Configurable connection timeout with rejection on timeout
    - Automatic reconnection with exponential backoff
    - Ping/pong heartbeat mechanism for connection health
    - Event-driven architecture with typed event emitters
    - Connection statistics tracking
    - Proper state machine transitions
  - WebSocketManager class:
    - Manages multiple concurrent connections
    - Configurable max connections limit
    - Connection creation with default config inheritance
    - Broadcast messaging to all connections
    - Connection retrieval by ID
    - Bulk disconnect and disposal
  - Factory functions: createWebSocketConnection, createWebSocketManager
  - Singleton: getSharedWebSocketManager, setSharedWebSocketManager, resetSharedWebSocketManager
- Created src/api/ws/index.ts with exports for all public APIs
- Created tests/api/ws/connection-manager.test.ts with 50 comprehensive tests:
  - Constructor tests (default config, custom ID, config merging)
  - Connect tests (successful connection, state transitions, open event, timeout handling, error handling)
  - Disconnect tests (clean disconnect, close event, idempotent disconnect)
  - Send tests (string messages, JSON messages, connected check, stats update)
  - Message handling tests (event emission, JSON parsing, non-JSON handling, stats update)
  - Event listener tests (add/remove, once listeners, removeAllListeners)
  - Reconnection tests (abnormal close triggers reconnect, clean close no reconnect, max attempts, exponential backoff)
  - Connection info tests
  - WebSocketManager tests (creation, connection management, limits, broadcast)
  - Shared manager tests (singleton, reset)
  - Constants export tests
- Mock WebSocket implementation for Node.js testing:
  - MockWebSocket class implementing IWebSocket interface
  - MockEvent and MockCloseEvent for Node.js compatibility
  - Configurable connection delays and error injection
  - Simulated message, close, and error events
- Bug fixes during implementation:
  - Fixed type issue with optional protocols in WebSocketConfig
  - Fixed state check in onerror handler (save state before handleError changes it)
- All 1250 tests pass (50 new tests added)
- TypeScript typecheck passes
- Build compiles successfully

COMPLETED: API-WS-002 - WebSocket auto-reconnection
- Created src/api/ws/auto-reconnect.ts with comprehensive auto-reconnection functionality:
  - ReconnectableConnection class extending WebSocketConnection with:
    - Subscription tracking system for restoration after reconnect
    - Reconnection state management (isReconnecting, attempt, totalAttempts, exhausted)
    - Events: subscriptionRestored, subscriptionsRestored, reconnectExhausted
    - Manual reconnection via forceReconnect()
    - Subscription management: addSubscription, removeSubscription, getSubscription, getAllSubscriptions
    - Automatic subscription restoration after successful reconnect
- New types exported:
  - Subscription: Subscription information for restoration
  - SubscriptionRestoredEvent, SubscriptionsRestoredEvent: Restoration events
  - ReconnectConfig: Reconnection configuration options
  - ReconnectableConnectionConfig: Extended connection config
  - ReconnectionState: Current reconnection state
  - ReconnectEventListenerMap: Event listener types
- Utility functions:
  - calculateBackoffDelay(): Exponential backoff calculation
  - calculateBackoffDelayWithJitter(): Backoff with jitter to prevent thundering herd
  - shouldReconnectOnClose(): Determine if close code should trigger reconnection
  - getReconnectDelayForCloseCode(): Get appropriate delay for specific close codes
- Features:
  - Configurable auto-reconnect, max attempts, delays, backoff multiplier
  - Subscription restoration can be enabled/disabled
  - Configurable subscription restoration delay and timeout
  - Event proxying from underlying connection
  - State tracking: attempt count, total attempts, last reconnect timestamp
  - reconnectExhausted event when max attempts reached
  - Manual resetReconnectionAttempts() to allow retry after exhaustion
  - forceReconnect() for manual reconnection trigger
- Updated src/api/ws/index.ts with all new exports
- Created tests/api/ws/auto-reconnect.test.ts with 51 comprehensive tests:
  - Constructor tests (default config, custom reconnect config)
  - Connect/disconnect tests (successful connection, events, dispose error)
  - Send message tests (string, JSON)
  - Reconnection state tests (tracking, reset, exhausted event, manual reset)
  - Force reconnect tests
  - Subscription management tests (add, remove, get, getAll, getByChannel, count, clear)
  - Subscription restoration tests (after reconnect, disabled, failure handling, manual restore)
  - Event listener tests (proxy events, once, off, removeAllListeners)
  - Utility function tests (calculateBackoffDelay, withJitter, shouldReconnectOnClose, getDelayForCloseCode)
  - Dispose tests (cleanup, idempotent)
- Bug fixes during implementation:
  - Fixed type error with circular reference in once() listener wrapper
  - Fixed type error with includes() on const array by adding explicit number[] type
  - Fixed test for unhandled promise rejections using .catch() pattern
- All 1301 tests pass (51 new tests added)
- TypeScript typecheck passes

COMPLETED: API-WS-003 - Subscribe to market updates
- Created src/api/ws/market-subscriptions.ts with comprehensive market subscription functionality:
  - MarketSubscriptionClient class: Main client for subscribing to real-time price updates
  - subscribe(): Subscribe to one or more market token IDs
  - unsubscribe(), unsubscribeToken(), unsubscribeAll(): Unsubscribe from markets
  - resubscribeAll(): Re-subscribe to all active subscriptions after reconnect
  - getCurrentPrice(), getAllCurrentPrices(): Get current price data
  - getSubscription(), getSubscriptionForToken(), getAllSubscriptions(): Query subscriptions
  - Subscription tracking: count, token count, subscribed token IDs
- Constants and types:
  - POLYMARKET_WS_URL: "wss://ws-subscriptions-clob.polymarket.com/ws/market"
  - SubscriptionMessageType: subscribe, unsubscribe, subscribed, unsubscribed, price_update, book, trade, error, ping, pong
  - SubscriptionChannel: market, price, book, trades
  - MarketSubscriptionRequest: Request config with tokenIds, channel, includeBook, includeTrades
  - PriceUpdate: Raw price update from WebSocket
  - ParsedPriceUpdate: Enriched with probability, midPrice, isSignificant, parsedTimestamp, receivedAt
  - MarketSubscriptionInfo: Subscription state with prices map, update count, confirmed status
  - Event types: PriceUpdateEvent, SubscriptionConfirmedEvent, SubscriptionErrorEvent, SignificantPriceChangeEvent
- Utility functions:
  - generateSubscriptionId(): Generate unique subscription ID
  - normalizeTokenIds(): Convert string or array to array
  - buildSubscriptionMessage(): Build Polymarket-compatible subscription message
  - parseMessageTimestamp(): Parse ISO or Unix timestamps
  - parsePriceUpdate(): Parse raw update into ParsedPriceUpdate with computed fields
  - isSubscriptionConfirmation(), isPriceUpdateMessage(), isErrorMessage(): Type guards
- Configuration options:
  - wsUrl: Custom WebSocket URL
  - significantChangeThreshold: Threshold for significant price changes (default 0.01 = 1%)
  - autoSubscribe: Auto-subscribe on connect
  - autoSubscribeTokenIds: Token IDs for auto-subscribe
  - pingInterval: Heartbeat interval
  - debug: Enable debug logging
- Event system:
  - priceUpdate: Emitted on price update
  - subscriptionConfirmed: Emitted when subscription confirmed
  - subscriptionError: Emitted on subscription error
  - significantPriceChange: Emitted on price change above threshold
  - connected, disconnected, reconnecting: Connection state events
  - on(), off(), once(), removeAllListeners(): Event listener management
- Integration with auto-reconnect:
  - Uses ReconnectableConnection for auto-reconnection
  - Subscription restoration after reconnect
  - Pending confirmation tracking with timeout
- Singleton management:
  - createMarketSubscriptionClient(): Factory function
  - getSharedMarketSubscriptionClient(), setSharedMarketSubscriptionClient(), resetSharedMarketSubscriptionClient()
- Updated src/api/ws/index.ts with all new exports
- Created tests/api/ws/market-subscriptions.test.ts with 88 comprehensive tests:
  - Constants tests (POLYMARKET_WS_URL, SubscriptionMessageType, SubscriptionChannel)
  - generateSubscriptionId tests (uniqueness, format)
  - normalizeTokenIds tests (string, array, empty)
  - buildSubscriptionMessage tests (single token, multiple, unsubscribe, channel, subscription ID)
  - parseMessageTimestamp tests (ISO, Unix seconds/milliseconds, invalid)
  - parsePriceUpdate tests (probability calculation, price change, significant detection, fallback fields, mid price, edge cases)
  - isSubscriptionConfirmation, isPriceUpdateMessage, isErrorMessage tests
  - MarketSubscriptionClient constructor tests (default config, custom URL)
  - connect/disconnect tests (events, state transitions, disposed client)
  - subscribe tests (single token, multiple, message format, errors, confirmation events, tracking)
  - unsubscribe tests (by ID, by token, unknown, unsubscribe all)
  - price update tests (events, price tracking, significant changes, update count)
  - error handling tests (error messages)
  - event handling tests (add/remove listeners, once, removeAllListeners)
  - dispose tests (cleanup, idempotent)
  - Shared client singleton tests
- Bug fixes during implementation:
  - Fixed floating-point precision issues in tests using toBeCloseTo()
  - Removed unused type imports (PriceUpdate, SubscriptionConfirmation)
- All 1389 tests pass (88 new tests added)
- TypeScript typecheck passes
- Browser smoke test passes
- Next up: API-WS-004

COMPLETED: API-WS-004 - Subscribe to trade stream
- Created src/api/ws/trade-stream.ts with comprehensive trade stream functionality:
- TradeStreamClient class:
  - connect()/disconnect(): Connection management with ReconnectableConnection
  - subscribe(): Subscribe to trade stream for token IDs
  - unsubscribe(): Unsubscribe by subscription ID
  - unsubscribeToken(): Unsubscribe by token ID
  - unsubscribeAll(): Remove all subscriptions
  - getRecentTrades(): Get recent trades for a token
  - getStats(): Get trade statistics
  - dispose(): Clean up all resources
- Constants:
  - POLYMARKET_TRADES_WS_URL: WebSocket endpoint for trades
  - DEFAULT_BUFFER_SIZE: Default buffer size (1000)
  - DEFAULT_FLUSH_INTERVAL: Default flush interval (5000ms)
  - DEFAULT_MAX_TRADES_PER_TOKEN: Max trades to store per token (1000)
- Type definitions:
  - TradeStreamDirection: "buy" | "sell"
  - RawTradeMessage: Raw WebSocket trade data
  - ParsedTrade: Parsed trade with computed fields (probability, valueUsd, isLargeTrade)
  - TradeStreamSubscriptionRequest: Subscription request format
  - TradeStreamSubscriptionInfo: Subscription metadata
  - TradeEvent, TradeBatchEvent, LargeTradeEvent: Event types
  - TradeStreamStats: Statistics for trade analysis
  - TradeStreamConfig: Configuration options
- Utility functions:
  - parseTradeDirection(): Convert string to TradeStreamDirection
  - parseTradeMessage(): Parse raw message to ParsedTrade
  - isTradeMessage(): Type guard for trade messages
  - buildTradeSubscriptionMessage(): Build subscription message
  - calculateTradeStreamStats(): Calculate statistics from trades
  - filterTradesByMinSize(): Filter trades by minimum size
  - filterTradesByTimeRange(): Filter trades by time range
  - groupTradesByAsset(): Group trades by asset/token ID
  - sortTradesByTime(): Sort trades by timestamp
- Configuration options:
  - wsUrl: Custom WebSocket URL
  - bufferSize: Size of trade buffer (default 1000)
  - flushInterval: Interval to flush buffered trades (default 5000ms)
  - maxTradesPerToken: Max trades stored per token (default 1000)
  - largeTradeThreshold: Threshold for large trade detection (default 10000)
  - enableBuffering: Enable batch buffering (default false)
  - confirmationTimeout: Timeout for subscription confirmation (default 10000ms)
  - debug: Enable debug logging
- Event system:
  - trade: Emitted on each trade
  - tradeBatch: Emitted for batched trades (when buffering enabled)
  - largeTrade: Emitted when trade exceeds threshold
  - subscriptionConfirmed: Emitted when subscription confirmed
  - subscriptionError: Emitted on subscription error
  - connected, disconnected, reconnecting: Connection state events
  - on(), off(), once(), removeAllListeners(): Event listener management
- Buffering and high-volume handling:
  - Trade buffering with configurable batch size and flush interval
  - Per-token trade storage with configurable max limit
  - Automatic cleanup of old trades
  - Large trade detection and alerting
- Singleton management:
  - createTradeStreamClient(): Factory function
  - getSharedTradeStreamClient(), setSharedTradeStreamClient(), resetSharedTradeStreamClient()
- Updated src/api/ws/index.ts with all new exports (lines 117-156)
- Created tests/api/ws/trade-stream.test.ts with 122 comprehensive tests:
  - Constants tests (POLYMARKET_TRADES_WS_URL, buffer defaults)
  - parseTradeDirection tests (buy, sell, case insensitive, invalid)
  - parseTradeMessage tests (complete parsing, probability calculation, USD value, large trade detection, defaults)
  - isTradeMessage tests (valid/invalid messages)
  - buildTradeSubscriptionMessage tests (single/multiple tokens, unsubscribe, format)
  - calculateTradeStreamStats tests (count, volume, average size, largest trade, time range, buy/sell counts, empty)
  - filterTradesByMinSize tests (filter, empty, equal to min)
  - filterTradesByTimeRange tests (filter, empty, inclusive boundaries)
  - groupTradesByAsset tests (multiple tokens, single, empty)
  - sortTradesByTime tests (descending, ascending, original unchanged)
  - TradeStreamClient constructor tests (default config, custom config)
  - connect/disconnect tests (events, state transitions, disposed client)
  - subscribe tests (single token, multiple, tracking, errors)
  - unsubscribe tests (by ID, by token, unknown, unsubscribe all)
  - trade event tests (parsing, tracking, recent trades retrieval)
  - large trade detection tests (threshold, events)
  - buffering tests (disabled by default, batching when enabled)
  - stats calculation tests
  - dispose tests (cleanup, idempotent)
  - Shared client singleton tests
- Bug fixes during implementation:
  - Added confirmationTimeout config option to fix test timeouts
  - Removed unused SubscriptionChannelValue import
  - Removed unused test imports (TradeEvent, TradeBatchEvent, LargeTradeEvent)
  - Added non-null assertions for array access in tests
- All 1511 tests pass (122 new tests added)
- TypeScript typecheck passes
- Dev server verified running at localhost:3000

COMPLETED: API-WS-005 - Subscribe to order book updates
- Created src/api/ws/orderbook-stream.ts with comprehensive order book streaming:
  - Constants: POLYMARKET_BOOK_WS_URL, DEFAULT_MAX_BOOK_LEVELS (50), DEFAULT_SNAPSHOT_INTERVAL (30000ms)
  - Types: BookSide, DeltaType, RawBookLevel, RawBookUpdateMessage, ParsedBookLevel, OrderBookState
  - OrderBookSubscriptionRequest, OrderBookSubscriptionInfo for subscription management
  - Event types: OrderBookUpdateEvent, OrderBookSnapshotEvent, SpreadChangeEvent, BookImbalanceEvent
  - OrderBookConfirmedEvent, OrderBookErrorEvent for subscription lifecycle
  - OrderBookStats for analytics, OrderBookStreamConfig for configuration
  - OrderBookStreamEventListenerMap for typed event listeners
- Utility functions for order book parsing:
  - parseBookLevel(): Parse raw [price, size] arrays into typed objects
  - parseBookSide(): Parse array of book levels
  - isOrderBookMessage(): Type guard for order book messages
  - buildBookSubscriptionMessage(): Build subscription JSON messages
  - parseOrderBookMessage(): Full message parsing with timestamps
- Order book state management:
  - createEmptyOrderBook(): Initialize empty order book state
  - applyDeltaUpdate(): Apply incremental delta updates to book state
  - Supports delta types: insert, update, delete
  - Maintains sorted bids (descending) and asks (ascending)
  - Tracks best bid/ask, spread, mid price
  - Calculates total bid/ask volume, level counts
- Analytics and market impact functions:
  - calculateOrderBookStats(): Compute comprehensive stats from order book
  - getCumulativeVolumeAtPrice(): Get total volume up to a price level
  - getPriceForVolume(): Find price needed to fill a given volume
  - calculateMarketImpact(): Estimate price impact for trade size
- OrderBookStreamClient class with full lifecycle management:
  - Constructor accepts config, logger, and WebSocket class injection
  - connect(): Establish WebSocket connection
  - disconnect(): Close connection gracefully
  - subscribe(tokenId): Subscribe to order book for a token
  - unsubscribe(subscriptionId): Remove subscription by ID
  - unsubscribeByToken(tokenId): Remove subscription by token
  - unsubscribeAll(): Remove all subscriptions
  - getOrderBook(tokenId): Get current order book state
  - getBestBid/getBestAsk(tokenId): Get best prices
  - getSpread(tokenId): Get bid-ask spread
  - getStats(tokenId): Get order book statistics
  - getAllSubscriptions(): Get all active subscriptions
  - dispose(): Clean up resources
- Configuration options (OrderBookStreamConfig):
  - wsUrl: WebSocket URL (default POLYMARKET_BOOK_WS_URL)
  - maxBookLevels: Maximum book levels to maintain (default 50)
  - snapshotInterval: Periodic snapshot interval (default 30000ms)
  - spreadChangeThreshold: Threshold for spread change events (default 0.01)
  - imbalanceThreshold: Threshold for book imbalance events (default 0.3)
  - confirmationTimeout: Subscription confirmation timeout (default 10000ms)
  - debug: Enable debug logging
- Event system:
  - orderBookUpdate: Emitted on each book update
  - orderBookSnapshot: Emitted for periodic snapshots
  - spreadChange: Emitted when spread changes significantly
  - bookImbalance: Emitted when bid/ask imbalance detected
  - orderBookConfirmed: Emitted when subscription confirmed
  - orderBookError: Emitted on subscription error
  - connected, disconnected, reconnecting: Connection state events
  - on(), off(), once(), removeAllListeners(): Event listener management
- Order book maintenance features:
  - Real-time delta updates (insert, update, delete)
  - Automatic sorting of bids/asks
  - Level trimming to maxBookLevels
  - Spread and mid price calculation
  - Book imbalance detection
  - Periodic snapshot emission
- Singleton management:
  - createOrderBookStreamClient(): Factory function
  - getSharedOrderBookStreamClient(), setSharedOrderBookStreamClient(), resetSharedOrderBookStreamClient()
- Updated src/api/ws/index.ts with all new exports (lines 158-202)
- Created tests/api/ws/orderbook-stream.test.ts with 102 comprehensive tests:
  - Constants tests (POLYMARKET_BOOK_WS_URL, DEFAULT_MAX_BOOK_LEVELS, DEFAULT_SNAPSHOT_INTERVAL)
  - parseBookLevel tests (valid levels, defaults, negative values, edge cases)
  - parseBookSide tests (multiple levels, empty, invalid items)
  - isOrderBookMessage tests (valid/invalid messages)
  - buildBookSubscriptionMessage tests (single/multiple tokens, unsubscribe)
  - createEmptyOrderBook tests (structure, initial values)
  - applyDeltaUpdate tests (insert, update, delete, sorting, level trimming)
  - parseOrderBookMessage tests (full parsing, bids/asks extraction)
  - calculateOrderBookStats tests (volume, spread, imbalance, empty book)
  - getCumulativeVolumeAtPrice tests (bids, asks, beyond range)
  - getPriceForVolume tests (full fill, partial fill, insufficient liquidity)
  - calculateMarketImpact tests (buy impact, sell impact, various sizes)
  - OrderBookStreamClient constructor tests (default config, custom config)
  - connect/disconnect tests (events, state transitions, disposed client)
  - subscribe tests (single token, multiple, tracking, errors)
  - unsubscribe tests (by ID, by token, unknown, unsubscribe all)
  - order book state tests (getOrderBook, getBestBid, getBestAsk, getSpread)
  - stats calculation tests
  - dispose tests (cleanup, event listeners)
  - Shared client singleton tests
- Bug fixes during implementation:
  - Removed unused parseMessageTimestamp import
  - Removed unused newBidPrices variable declaration
  - Removed unused mockWs variable in tests
  - Removed unused type imports (BookSide, ParsedBookLevel, OrderBookUpdateEvent, etc.)
- All 1613 tests pass (102 new tests added)
- TypeScript typecheck passes
- Dev server verified running at localhost:3000

COMPLETED: API-WS-006 - WebSocket message parser
- Created src/api/ws/message-parser.ts with comprehensive message parsing capabilities:
  - Constants: MessageType (15 types), MessageCategory (5 categories), ParseErrorCode (7 codes)
  - Type definitions for parsing: BaseMessage, ParseError, ParsedMessage, ValidationRule, MessageSchema
  - Configuration types: MessageParserConfig, ParserStats
- Utility functions for message handling:
  - determineMessageType(): Determines message type from parsed data (supports inference from structure)
  - determineMessageCategory(): Maps message types to categories
  - isValidJson(): Check if a string is valid JSON
  - safeJsonParse(): Parse JSON with detailed error information
  - arrayBufferToString(): Convert ArrayBuffer to string using TextDecoder
  - blobToString(): Convert Blob to string using Blob.text() (Node.js 18+ compatible)
  - validateMessageSchema(): Validate message against schema with custom rules
  - createParseError(): Factory function for parse errors
  - isPingPongMessage(): Check for ping/pong/heartbeat messages
  - isSubscriptionMessage(): Check for subscription-related messages
  - isMarketDataMessage(): Check for market data messages (price, trade, book)
  - isErrorMessageType(): Check for error messages
  - extractMessageId(): Extract message ID from various field names
  - extractTimestamp(): Extract and parse timestamp from message
- Default schemas for common message types:
  - price_update: Validates price field (0-1 range)
  - trade: Validates price and size fields
  - book: Validates bids/asks arrays
  - error: Validates error/message fields
- MessageParser class with full feature set:
  - Constructor accepts config: validateSchema, schemas, logErrors, maxMessageSize, trackUnknownTypes, logger, debug
  - parse<T>(rawData): Parse string or ArrayBuffer, returns ParsedMessage<T>
  - parseAsync<T>(rawData): Async parse supporting Blob data
  - addSchema(schema): Add custom validation schema
  - removeSchema(type): Remove schema by type (case insensitive)
  - getSchemas(): Get all registered schemas
  - getStats(): Get parsing statistics (returns copy to prevent mutation)
  - resetStats(): Reset all statistics
  - getUnknownTypes(): Get list of unknown message types encountered
  - isDisposed(): Check if parser is disposed
  - dispose(): Clean up resources
- Statistics tracking:
  - totalParsed: Total messages processed
  - successfulParses/failedParses: Success/failure counts
  - messagesByType: Map of counts by message type
  - messagesByCategory: Map of counts by category
  - errorsByCode: Map of error counts by error code
  - unknownTypes: Set of unknown type strings encountered
  - avgParseTimeMs/maxParseTimeMs: Performance metrics
  - startedAt/lastMessageAt: Timing information
- Singleton management:
  - createMessageParser(): Factory function
  - getSharedMessageParser(), setSharedMessageParser(), resetSharedMessageParser()
- Updated src/api/ws/index.ts with all new exports (constants, functions, types)
- Created tests/api/ws/message-parser.test.ts with 140 comprehensive tests:
  - MessageType constants tests (subscription, market data, system, connection types)
  - MessageCategory constants tests
  - ParseErrorCode constants tests
  - determineMessageType tests (null, non-object, subscription, market, system, connection, case insensitive, structure inference)
  - determineMessageCategory tests (all categories)
  - isValidJson tests (valid/invalid JSON)
  - safeJsonParse tests (success, arrays, error details, truncation)
  - arrayBufferToString tests (basic, empty, JSON)
  - blobToString tests (basic, empty, JSON)
  - validateMessageSchema tests (valid, missing required, wrong type, optional, custom validation, multiple types)
  - createParseError tests
  - isPingPongMessage tests (ping, pong, heartbeat, case insensitive)
  - isSubscriptionMessage tests (all subscription types)
  - isMarketDataMessage tests (explicit types, structure inference)
  - isErrorMessageType tests
  - extractMessageId tests (id, message_id, request_id, number conversion)
  - extractTimestamp tests (missing, milliseconds, seconds, ISO string, alternatives, invalid)
  - defaultSchemas tests
  - MessageParser constructor tests (default, custom config, custom schemas)
  - parse tests (valid JSON, types, invalid JSON, empty, whitespace, size limit, ArrayBuffer, time tracking)
  - parseAsync tests (string, ArrayBuffer, Blob)
  - schema management tests (add, remove)
  - statistics tests (total, success, failure, by type, by category, errors, unknown types, timing)
  - dispose tests
  - validation tests
  - debug/error logging tests
  - Factory and singleton tests
  - Integration tests (realistic streams, mixed types, malformed messages, many messages)
- Bug fixes during implementation:
  - Removed unused 'error' variable in schema validation
  - Changed blobToString to use Blob.text() instead of FileReader (not available in Node.js)
- All 1753 tests pass (140 new tests added)
- TypeScript typecheck passes
- Dev server verified running at localhost:3000
- Next up: API-WS-007

COMPLETED: API-WS-007 - WebSocket heartbeat handler
- Created src/api/ws/heartbeat-handler.ts with comprehensive heartbeat management:
  - Constants: DEFAULT_PING_INTERVAL (30000ms), DEFAULT_PONG_TIMEOUT (10000ms), DEFAULT_MISSED_PONGS_THRESHOLD (2), DEFAULT_LATENCY_HISTORY_SIZE (10), DEFAULT_STALE_THRESHOLD (60000ms)
  - HeartbeatMessageType: PING, PONG, HEARTBEAT
  - HeartbeatEventType: PING_SENT, PONG_RECEIVED, PONG_TIMEOUT, STALE_DETECTED, HEARTBEAT_FAILURE, HEARTBEAT_STARTED, HEARTBEAT_STOPPED
- Type definitions:
  - HeartbeatConfig: pingInterval, pongTimeout, missedPongsThreshold, latencyHistorySize, staleThreshold, autoStart, pingMessage, useJsonFormat, pongMatcher, debug, logger
  - HeartbeatStats: totalPingsSent, totalPongsReceived, totalMissedPongs, consecutiveMissedPongs, avgLatencyMs, minLatencyMs, maxLatencyMs, lastPingAt, lastPongAt, lastActivityAt, isActive, isPongPending, isStale, latencyHistory
  - Event types: PingSentEvent, PongReceivedEvent, PongTimeoutEvent, StaleDetectedEvent, HeartbeatFailureEvent, HeartbeatStartedEvent, HeartbeatStoppedEvent
  - SendFunction and ReconnectFunction types
- Utility functions:
  - isPingMessage(): Check if message is a ping (plain text or JSON)
  - isPongMessage(): Check if message is a pong (plain text or JSON)
  - createPingMessage(useJson): Create ping message in plain or JSON format
  - createPongMessage(useJson): Create pong message in plain or JSON format
  - calculateAverage(values): Calculate average of number array
- HeartbeatHandler class with full feature set:
  - Constructor accepts HeartbeatConfig
  - setSendFunction(fn): Set the function to send ping messages
  - setReconnectFunction(fn): Set the function to trigger reconnection
  - getConfig(): Get current configuration
  - start(): Start heartbeat with ping interval and stale check
  - stop(reason): Stop heartbeat and clear timers
  - restart(): Stop and start heartbeat
  - dispose(): Clean up all resources
  - getIsDisposed(): Check if handler is disposed
  - sendPing(): Manually send a ping
  - handleMessage(message): Handle incoming message and check for pong
  - notifyActivity(): Manually update last activity timestamp
  - getStats(): Get current heartbeat statistics
  - resetStats(): Reset all statistics
  - getCurrentLatency(): Get most recent latency measurement
  - getAverageLatency(): Get average latency
  - isConnectionStale(): Check if connection is stale
  - getIsActive(): Check if heartbeat is active
- Event handling:
  - on(event, listener): Add event listener with unsubscribe function
  - off(event, listener): Remove event listener
  - once(event, listener): Add one-time listener
  - removeAllListeners(event?): Remove all listeners
- Features:
  - Configurable ping interval with customizable ping message (string or function)
  - Pong timeout detection with configurable threshold
  - Consecutive missed pongs tracking with failure threshold
  - Stale connection detection based on inactivity
  - Latency tracking with history and statistics (min, max, avg)
  - Automatic reconnection trigger on heartbeat failure
  - Support for both plain text and JSON ping/pong formats
  - Custom pong message matcher support
  - Debug logging support
- Singleton management:
  - createHeartbeatHandler(): Factory function
  - getSharedHeartbeatHandler(), setSharedHeartbeatHandler(), resetSharedHeartbeatHandler()
- Integration helper:
  - attachHeartbeatHandler(options): Create and attach handler to connection
- Updated src/api/ws/index.ts with all new exports
- Created tests/api/ws/heartbeat-handler.test.ts with 96 comprehensive tests:
  - Default constants tests
  - HeartbeatMessageType constants tests
  - HeartbeatEventType constants tests
  - isPingMessage tests (plain, case insensitive, JSON, heartbeat, non-ping, invalid JSON)
  - isPongMessage tests (plain, case insensitive, JSON, non-pong)
  - createPingMessage tests (plain and JSON)
  - createPongMessage tests (plain and JSON)
  - calculateAverage tests (empty, single, multiple, decimals)
  - HeartbeatHandler constructor tests (default, custom config, custom ping message)
  - Lifecycle tests (start, stop, restart, dispose, events)
  - Ping/pong tests (intervals, events, JSON format, custom messages)
  - Pong timeout tests (timeout event, consecutive tracking, failure threshold, reconnect)
  - Stale detection tests (detection, failure event, activity reset)
  - Statistics tests (ping/pong counts, latency tracking, min/max, history limits, reset)
  - Event handling tests (add, remove, once, removeAll, error handling)
  - Send failure tests
  - Factory and singleton tests
  - attachHeartbeatHandler helper tests
  - Edge cases (pong without pending, non-pong message, multiple dispose)
  - Integration tests (ping-pong sequence, intermittent failures, recovery workflow)
- Bug fixes during implementation:
  - Fixed getCurrentLatency to handle undefined array access
  - Fixed test type issues with SendFunction type annotation
  - Adjusted stale detection tests timing for accurate threshold checks
- All 1849 tests pass (96 new tests added)
- TypeScript typecheck passes
- Dev server verified running at localhost:3000
- Next up: API-WS-008

COMPLETED: API-WS-008 - WebSocket message queue
- Created src/api/ws/message-queue.ts with comprehensive message queue functionality:
  - MessageQueue class: High-performance queue for WebSocket message handling
  - createMessageQueue(): Factory function for creating new queues
  - getSharedMessageQueue/setSharedMessageQueue/resetSharedMessageQueue: Singleton management
  - createFilteredProcessor(): Create processors that route by message type
  - createBatchProcessor(): Create processors that batch messages before handling
  - calculateQueueHealth(): Calculate health score 0-100 based on stats
- Core features:
  - Asynchronous message processing with configurable batch sizes
  - Priority queue support (high, normal, low) with insertion ordering
  - Backpressure handling with four strategies: dropOldest, dropNewest, block, error
  - High/low water marks for triggering and releasing backpressure
  - Queue depth monitoring with comprehensive statistics
  - Processing rate tracking (messages per second)
  - Wait time tracking (average and max)
  - Error tracking and handling
- Configuration options:
  - maxSize: Maximum queue size (default: 10000)
  - batchSize: Batch size for processing (default: 100)
  - processingInterval: Processing interval in ms (default: 10)
  - backpressureStrategy: "dropOldest" | "dropNewest" | "block" | "error"
  - highWaterMark: Threshold to activate backpressure (default: 80% of maxSize)
  - lowWaterMark: Threshold to release backpressure (default: 50% of maxSize)
  - enablePriority: Enable priority queue ordering (default: false)
- Event system with typed events:
  - messageEnqueued, messageProcessed, messageDropped
  - processingError, batchProcessed
  - backpressureStart, backpressureEnd
  - queueEmpty, queueFull, stateChange
- Queue operations:
  - enqueue(): Add message to queue
  - enqueueBatch(): Add multiple messages at once
  - setProcessor(): Set the message processing function
  - start()/stop(): Control processing
  - pause()/resume(): Pause/resume without stopping timer
  - clear(): Clear all messages
  - peek(): View next message without removing
  - getMessages(): Get all queued messages
  - getStats(): Get comprehensive queue statistics
  - dispose(): Clean up resources
- Utility functions:
  - createFilteredProcessor(): Route messages by type to specific handlers
  - createBatchProcessor(): Batch messages with size/time-based flushing
  - calculateQueueHealth(): Score queue health based on utilization, errors, wait times
  - PRIORITY_VALUES: Priority ordering constants
- Added types:
  - MessagePriority, QueuedMessage, MessageProcessor
  - BackpressureStrategy, QueueState
  - MessageQueueConfig, QueueStats
  - All event types (MessageEnqueuedEvent, etc.)
  - EnqueueOptions, EnqueueResult
  - QueueLogger interface
- Updated src/api/ws/index.ts to export all new functions, types, and constants
- Created comprehensive tests in tests/api/ws/message-queue.test.ts (63 test cases):
  - Constructor tests (default config, custom config, water mark calculation)
  - Enqueue tests (basic, with options, multiple, disposed queue, events, auto-ID)
  - enqueueBatch tests
  - Priority queue tests (ordering, insertion, disabled priority)
  - Processing tests (basic, events, async, errors, batching, queueEmpty)
  - Pause/resume tests
  - Backpressure tests for all strategies:
    - dropOldest: activation, dropping, release at low water mark
    - dropNewest: dropping new messages when full
    - block: blocking until space available
    - error: throwing error when full
  - Clear tests (basic, end backpressure)
  - Peek/getMessages tests
  - getStats tests (basic, processing, errors, utilization)
  - State management tests
  - Event listener tests (add/remove, once, removeAll)
  - Dispose tests
  - Singleton function tests
  - createFilteredProcessor tests
  - createBatchProcessor tests (batching, flush interval, manual flush, dispose)
  - calculateQueueHealth tests (healthy, utilization penalty, error penalty, wait time penalty, backpressure penalty, clamping)
  - PRIORITY_VALUES constant tests
- All 1912 tests pass (63 new tests added)
- TypeScript typecheck passes
- Next up: API-WS-009

## API-WS-009: Multi-market Subscription Manager - COMPLETED
- Created src/api/ws/subscription-manager.ts with MultiMarketSubscriptionManager class
- Key features:
  - Track active subscriptions across multiple markets
  - Batch subscription requests with configurable delay and size
  - Handle subscription limits per connection
  - Provide subscription status and health monitoring
  - Auto-resubscription support for reconnection scenarios
  - Stale subscription detection
  - Priority-based subscription ordering
- Main class: MultiMarketSubscriptionManager
  - subscribe(): Subscribe to single or multiple tokens
  - subscribeMany(): Subscribe to multiple markets at once
  - unsubscribe(): Unsubscribe by subscription ID
  - unsubscribeByToken(): Unsubscribe by token ID
  - unsubscribeAll(): Unsubscribe from all subscriptions
  - pauseSubscription()/resumeSubscription(): Pause/resume subscriptions
  - handleConfirmation(): Mark subscription as confirmed
  - handleError(): Handle subscription errors with retry logic
  - handlePriceUpdate(): Update subscription state on price updates
  - handleConnectionStateChange(): Manage reconnection logic
  - getSubscriptions(): Filter and retrieve subscriptions
  - getHealth(): Get subscription health metrics
  - getStats(): Get subscription statistics
- Configuration options:
  - maxSubscriptionsPerConnection: Limit subscriptions per connection
  - maxTokensPerSubscription: Limit tokens per subscription
  - batchSize/batchDelay: Configure batching behavior
  - subscriptionTimeout: Timeout for subscription confirmation
  - maxRetries: Maximum retry attempts
  - staleSubscriptionThreshold: Threshold for stale detection
  - enableStaleDetection: Toggle stale detection
- Constants exported:
  - DEFAULT_MAX_SUBSCRIPTIONS_PER_CONNECTION (100)
  - DEFAULT_MAX_TOKENS_PER_SUBSCRIPTION (50)
  - DEFAULT_BATCH_SIZE (10)
  - DEFAULT_BATCH_DELAY (100ms)
  - DEFAULT_SUBSCRIPTION_TIMEOUT (10000ms)
  - DEFAULT_STALE_SUBSCRIPTION_THRESHOLD (60000ms)
  - SubscriptionStatus enum (PENDING, ACTIVE, PAUSED, ERROR, UNSUBSCRIBED)
  - BatchOperationType enum (SUBSCRIBE, UNSUBSCRIBE)
  - SubscriptionManagerEventType enum
- Utility functions:
  - calculateSubscriptionDistribution(): Distribute tokens across connections
  - mergeFilters(): Merge subscription filter criteria
  - matchesFilter(): Check if subscription matches filter
- Singleton management:
  - createMultiMarketSubscriptionManager(): Factory function
  - getSharedSubscriptionManager/setSharedSubscriptionManager/resetSharedSubscriptionManager
- Updated src/api/ws/index.ts to export all new functions, types, and constants
- Created comprehensive tests in tests/api/ws/subscription-manager.test.ts (99 test cases)
- All 2011 tests pass (99 new tests added)
- TypeScript typecheck passes
- Next up: API-WS-010


## API-WS-010: WebSocket Event Emitter - COMPLETED
- Created src/api/ws/event-emitter.ts with WebSocketEventEmitter class
- Key features implemented:
  - Strongly typed events with TypeScript generics
  - Event filtering capabilities with listener filter option
  - One-time event listeners (once method)
  - Event listener management (on, off, removeAllListeners)
  - Category-based listeners (onCategory for receiving all events in a category)
  - Global listeners (onAll for receiving all events)
  - Event history tracking (optional, configurable)
  - Error handling for listeners with HANDLER_ERROR events
  - Priority-based listener execution order
  - Async listener support with configurable timeout
  - Comprehensive statistics tracking
- Main class: WebSocketEventEmitter
  - emit(): Emit events to all registered listeners
  - on()/off(): Register/unregister type-specific listeners
  - onCategory()/offCategory(): Register/unregister category listeners
  - onAll()/offAll(): Register/unregister global listeners
  - once(): Register one-time listener
  - removeAllListeners(): Remove all listeners
  - listenerCount(): Get count of registered listeners
  - hasListeners(): Check if event type has listeners
  - eventTypes(): Get list of event types with listeners
  - getHistory()/getHistoryByType()/getHistoryByCategory(): Access event history
  - clearHistory(): Clear event history
  - getStats()/resetStats(): Get/reset statistics
  - dispose(): Clean up resources
- Constants exported:
  - EventCategory: connection, subscription, marketData, trade, orderBook, system, error
  - EventPriority: CRITICAL (0), HIGH (1), NORMAL (2), LOW (3)
  - WebSocketEventTypes: 25 predefined event types for various WebSocket events
- Utility functions:
  - createEventEmitter(): Factory function
  - getSharedEventEmitter/setSharedEventEmitter/resetSharedEventEmitter: Singleton management
  - createFilteredListener(): Create filtered event listener
  - createDebouncedListener(): Create debounced event listener
  - createThrottledListener(): Create throttled event listener
  - createBatchingListener(): Create batching event listener
  - createEventBuilder(): Create type-safe event builder for specific event types
- Event types:
  - BaseEvent: Base interface for all events
  - ConnectionOpenEventData, ConnectionCloseEventData, ConnectionErrorEventData
  - PriceUpdateEventData, TradeEventData, LargeTradeEventData
  - OrderBookUpdateEventData, HandlerErrorEventData, GenericEvent
- Updated src/api/ws/index.ts to export all new functions, types, and constants
- Created comprehensive tests in tests/api/ws/event-emitter.test.ts (77 test cases)
- All 2088 tests pass (77 new tests added)
- TypeScript typecheck passes
- Browser smoke test passes
- Next up: API-CHAIN-001 (Polygon RPC client setup)


## API-CHAIN-001: Polygon RPC Client Setup - COMPLETED
- Created src/api/chain/ directory structure
- Installed viem package for Ethereum/Polygon blockchain interactions
- Created src/api/chain/types.ts with comprehensive type definitions:
  - RpcEndpointConfig: RPC endpoint configuration with URL, priority, rate limits
  - PolygonClientConfig: Client configuration (endpoints, chain, timeout, retries, batch settings)
  - PolygonClientLogger: Custom logger interface
  - ConnectionState, ConnectionEvent: Connection lifecycle management
  - EndpointHealth: Endpoint health tracking
  - BlockInfo, TransactionInfo, TransactionReceipt, LogEntry: Blockchain data types
  - ClientStats: Client statistics interface
  - PolygonClientError: Custom error class with error codes
- Created src/api/chain/client.ts with PolygonClient class:
  - Multi-endpoint support with automatic failover
  - Default public Polygon RPC endpoints (polygon-rpc.com, matic.network, maticvigil.com)
  - Connection management (connect, disconnect, state tracking)
  - Connection event subscription system
  - Blockchain queries: getBlockNumber, getBlock, getBlockByHash, getTransaction,
    getTransactionReceipt, getBalance, getTransactionCount, getChainId, getGasPrice,
    estimateGas, getCode, isContract
  - Retry logic with exponential backoff
  - Endpoint health monitoring and automatic switching on failures
  - Request statistics tracking (success, failure, latency, retries)
  - Batch request support
  - Address validation using viem's isAddress/getAddress utilities
- Created src/api/chain/index.ts exporting all types and functions
- Updated .env.example with POLYGON_RPC_URL configuration
- Created tests/api/chain/client.test.ts with 52 test cases covering:
  - Constructor and configuration options
  - Factory functions (createPolygonClient, getSharedPolygonClient, etc.)
  - Connection lifecycle (connect, disconnect, events)
  - Blockchain queries (block, transaction, balance, gas, code)
  - Retry and failover logic
  - Statistics tracking
  - Endpoint health monitoring
  - Error handling and validation
  - Chain configuration
- Fixed TypeScript errors in tests/api/ws/event-emitter.test.ts:
  - Added non-null assertions for array access
  - Fixed callback return types (void instead of number)
  - Fixed type assertions for filter functions
  - Fixed emit method signature to allow extra properties
- All 2140 tests pass (52 new tests added)
- TypeScript typecheck passes
- Browser smoke test passes - app loads correctly at localhost:3000
- Next up: API-CHAIN-002 (Fetch wallet transaction history)


## API-CHAIN-002: Fetch Wallet Transaction History - COMPLETED
- Created src/api/chain/history.ts with PolygonscanClient class:
  - Polygonscan API integration for fetching wallet transaction history
  - getWalletHistory: Fetch paginated transaction history for a wallet address
  - getAllWalletHistory: Fetch all transactions with automatic pagination
  - getInternalTransactions: Fetch internal (contract call) transactions
  - getTransactionCount: Get nonce/transaction count for a wallet
  - Retry logic with exponential backoff for rate limits and errors
  - Request timeout handling
  - API key support for higher rate limits
- Updated src/api/chain/types.ts with new types:
  - WalletTransaction: Full transaction data from Polygonscan API
  - InternalTransaction: Internal/trace transaction data
  - WalletHistoryOptions: Pagination, block range, sort options
  - WalletHistoryResult: Paginated result with hasMore indicator
  - PolygonscanConfig: API configuration (key, baseUrl, timeout, retries)
  - PolygonscanError: Custom error class for API errors
- Updated src/api/chain/index.ts to export new types and functions
- Updated .env.example with POLYGONSCAN_API_KEY configuration
- Created tests/api/chain/history.test.ts with 49 test cases covering:
  - PolygonscanClient constructor and configuration
  - getWalletHistory with various options (pagination, block range, sort)
  - Transaction parsing (normal, failed, contract creation)
  - Different transaction types (normal, internal, erc20, erc721, erc1155)
  - getAllWalletHistory with automatic pagination
  - getInternalTransactions
  - getTransactionCount
  - Error handling (HTTP errors, API errors, rate limits)
  - Retry logic and max retry behavior
  - Singleton management (createPolygonscanClient, getSharedPolygonscanClient, etc.)
  - Convenience functions
  - PolygonscanError class
- All 2189 tests pass (49 new tests added)
- TypeScript typecheck passes
- Next up: API-CHAIN-003 (Fetch wallet token balances)


## API-CHAIN-003: Fetch Wallet Token Balances - COMPLETED
- Created src/api/chain/balances.ts with TokenBalanceClient class:
  - getNativeBalance: Fetch native MATIC balance for a wallet
  - getTokenBalance: Fetch specific ERC20 token balance for a wallet
  - getTokenBalances: Fetch all ERC20 token balances (via transfer history discovery)
  - getNFTTokens: Fetch ERC721 NFT tokens held by a wallet
  - getERC1155Balances: Fetch ERC1155 multi-token balances
  - getWalletBalanceSummary: Complete wallet balance summary (native + tokens)
  - Retry logic with exponential backoff
  - API key support for higher rate limits
  - Token transfer history analysis to discover held tokens
  - NFT ownership tracking (handles transfers in/out)
  - ERC1155 balance calculation from transfer history
- Updated src/api/chain/types.ts with new types:
  - TokenBalance: ERC20 token with balance and formatted value
  - NativeBalance: Native MATIC balance with formatted value
  - NFTToken: ERC721 NFT token data
  - ERC1155Balance: ERC1155 multi-token balance
  - WalletBalanceSummary: Complete wallet balance overview
  - TokenBalanceOptions: Options for balance queries
- Updated src/api/chain/index.ts to export new types and functions
- Created tests/api/chain/balances.test.ts with 51 test cases covering:
  - TokenBalanceClient constructor and configuration
  - getNativeBalance (MATIC balance, formatting, zero balance, validation)
  - getTokenBalance (specific token, decimals, zero balance handling)
  - getTokenBalances (token discovery, pagination, zero balance filtering)
  - getNFTTokens (ownership tracking, transfer out handling)
  - getERC1155Balances (balance calculation, multiple tokens)
  - getWalletBalanceSummary (complete summary)
  - Error handling (HTTP errors, rate limits, retry logic)
  - Factory functions and singleton management
  - Convenience functions with shared/custom client
- All 2240 tests pass (51 new tests added)
- TypeScript typecheck passes
- Browser smoke test passes - app loads correctly at localhost:3000
- Next up: API-CHAIN-004 (Fetch wallet creation date)


## API-CHAIN-004: Fetch Wallet Creation Date - COMPLETED
- Created src/api/chain/creation-date.ts with WalletCreationDateClient class:
  - getWalletCreationDate: Find first transaction and return creation date/timestamp
  - getWalletAgeInDays: Convenience method to get wallet age in days
  - isWalletFresh: Check if wallet is newer than a threshold (default: 30 days)
  - batchGetCreationDates: Batch fetch creation dates for multiple addresses
  - In-memory caching with configurable TTL (default: 1 hour)
  - Cache eviction when max entries reached (evicts at least 1 or 10% oldest entries)
  - Support for including internal transactions in search
  - Handle empty wallets (no transactions)
  - Cache statistics and invalidation methods
- Updated src/api/chain/index.ts to export new types and functions:
  - WalletCreationDate type (creation date, timestamp, first tx hash, age)
  - WalletCreationDateOptions type (client, bypassCache, includeInternalTransactions)
  - WalletCreationDateCacheConfig type (ttlMs, maxEntries, enabled)
  - Factory functions (createWalletCreationDateClient, getSharedWalletCreationDateClient, etc.)
  - Convenience functions (getWalletCreationDate, getWalletAgeInDays, isWalletFresh, batchGetCreationDates)
- Created tests/api/chain/creation-date.test.ts with 42 test cases covering:
  - WalletCreationDateClient constructor and configuration
  - getWalletCreationDate (successful fetch, age calculation, empty wallet, internal txs)
  - getWalletAgeInDays (age calculation, empty wallet handling)
  - isWalletFresh (threshold checking, empty wallet as fresh, default threshold)
  - batchGetCreationDates (multiple addresses, invalid address skipping)
  - Caching (cache hits, bypass, clear, invalidate, eviction)
  - Cache statistics
  - Factory functions and singleton management
  - Convenience functions with shared/custom client
  - Edge cases (zero timestamp, very old wallet, internal-only transactions, lowercase address)
- All 2282 tests pass (42 new tests added)
- TypeScript typecheck passes
- Next up: API-CHAIN-005 (Monitor wallet for new transactions)


## API-CHAIN-005: Monitor Wallet for New Transactions - COMPLETED
- Created src/api/chain/wallet-monitor.ts with WalletMonitor class:
  - WalletMonitor: Core class for real-time wallet transaction monitoring
  - addWallet/removeWallet: Add/remove wallet addresses from monitoring
  - start/stop: Control monitoring lifecycle
  - pollNow: Force immediate poll cycle
  - Configurable polling interval (default: 15 seconds)
  - Support for multiple transaction types: normal, internal, erc20
  - Event-based architecture with typed events:
    - NEW_TRANSACTION: Emitted when new transaction detected
    - NEW_INTERNAL_TRANSACTION: Emitted for internal transactions
    - MONITOR_STARTED/MONITOR_STOPPED: Lifecycle events
    - WALLET_ADDED/WALLET_REMOVED: Wallet management events
    - MONITOR_ERROR: Error events with error details
    - POLL_COMPLETE: Emitted after each polling cycle
  - Baseline establishment on first poll (no events emitted)
  - Block tracking per wallet to detect only new transactions
  - Error handling with catchErrors configuration option
  - Statistics tracking: poll cycles, transactions detected, errors, uptime
  - Listener management with once/on/off pattern
  - Wildcard listener support ("*")
  - Configurable Polygonscan client (retries, delay, timeout)
- Factory functions:
  - createWalletMonitor(): Create new instance
  - getSharedWalletMonitor(): Get singleton instance
  - setSharedWalletMonitor(): Set singleton instance
  - resetSharedWalletMonitor(): Reset and dispose singleton
- Convenience functions:
  - startMonitoringWallet(): Quick start monitoring a single wallet
  - monitorWallets(): Monitor multiple wallets at once
  - Both return stop() function and monitor reference
- Updated src/api/chain/index.ts to export all new types and functions:
  - Types: TransactionType, WalletMonitorEventTypeValue, WalletMonitorEvent,
    NewTransactionEvent, NewInternalTransactionEvent, MonitorStartedEvent,
    MonitorStoppedEvent, WalletAddedEvent, WalletRemovedEvent, MonitorErrorEvent,
    PollCompleteEvent, WalletMonitorEventData, WalletMonitorEventListener,
    WalletMonitorListenerOptions, WalletMonitorConfig, WalletMonitorLogger,
    WalletMonitorStats
  - Constants: WalletMonitorEventType
  - Class: WalletMonitor
- Created tests/api/chain/wallet-monitor.test.ts with 66 test cases covering:
  - Constructor (default config, custom config, custom logger)
  - Wallet Management (add/remove, normalization, validation, duplicates, events)
  - Monitor Control (start/stop, lifecycle events, polling interval, pollNow)
  - Event Listeners (on/off, wildcards, once, removeAllListeners, unsubscribe)
  - Transaction Detection (normal, internal, erc20, baseline establishment)
  - Error Handling (emit errors, catchErrors, throw on false, error count)
  - Statistics (poll cycles, running state, wallet count, transactions detected)
  - Dispose (cleanup, stop on dispose, operations throw after dispose)
  - Factory Functions (createWalletMonitor)
  - Singleton Management (getShared, setShared, resetShared, dispose on reset)
  - Convenience Functions (startMonitoringWallet, monitorWallets, stop function)
  - Multiple Transaction Types (simultaneous monitoring)
  - Edge Cases (empty wallet list, async/sync listener errors)
- All 2348 tests pass (66 new tests added)
- TypeScript typecheck passes
- Next up: API-CHAIN-006 (Decode Polymarket contract interactions)


## API-CHAIN-006: Decode Polymarket Contract Interactions - COMPLETED
- Created src/api/chain/contract-decoder.ts with ContractDecoder class:
  - Decode Polymarket smart contract interactions from transaction input data
  - Known contract addresses defined in POLYMARKET_CONTRACTS constant:
    - CTF_EXCHANGE: Main CTF Exchange for trading
    - NEG_RISK_CTF_EXCHANGE: Negative risk markets
    - CONDITIONAL_TOKENS: Gnosis Conditional Token Framework
    - USDC: Polygon USDC token
    - USDC_E: Bridged USDC on Polygon
    - PROXY_WALLET_FACTORY: Proxy wallet creation
    - ROUTER: Polymarket router
  - Known function selectors in FUNCTION_SELECTORS constant:
    - CTF Exchange: fillOrder, fillOrders, matchOrders, cancelOrder, cancelOrders
    - Conditional Tokens: splitPosition, mergePositions, redeemPositions
    - ERC1155: safeTransferFrom, safeBatchTransferFrom
    - ERC20: transfer, transferFrom, approve
    - NegRisk: convertPositions
  - Decoded interaction types with extracted parameters:
    - FILL_ORDER: tokenId, maker, side, price, size, fillAmount
    - FILL_ORDERS: orderCount, fillAmounts
    - CANCEL_ORDER/CANCEL_ORDERS: orderCount
    - SPLIT_POSITION: collateralToken, parentCollectionId, conditionId, amount
    - MERGE_POSITIONS: collateralToken, parentCollectionId, conditionId, amount
    - REDEEM_POSITIONS: collateralToken, parentCollectionId, conditionId, indexSets
    - TOKEN_TRANSFER/TOKEN_TRANSFER_FROM: from, to, amount, tokenSymbol, decimals, formattedAmount
    - TOKEN_APPROVE: spender, amount, isUnlimited, tokenSymbol
    - CTF_TRANSFER/CTF_BATCH_TRANSFER: from, to, tokenIds, amounts
    - CONVERT_POSITIONS: marketId, indexSet, amount
    - UNKNOWN: for unrecognized functions
  - Helper methods:
    - isPolymarketContract: Check if address is a known Polymarket contract
    - getContractName: Get contract name for an address
    - getFunctionInfo: Get function name and type from selector
    - batchDecode: Decode multiple transactions at once
    - filterByType: Filter decoded interactions by type
    - filterPolymarketOnly: Get only Polymarket interactions
  - Configurable options:
    - additionalContracts: Add custom contract addresses
    - decodeParameters: Enable/disable parameter extraction
    - debug: Enable debug logging
    - logger: Custom logger implementation
- Factory functions:
  - createContractDecoder(): Create new instance
  - getSharedContractDecoder(): Get singleton instance
  - setSharedContractDecoder(): Set singleton instance
  - resetSharedContractDecoder(): Reset singleton
- Convenience functions:
  - decodeContractInteraction(): Decode single transaction
  - batchDecodeContractInteractions(): Decode multiple transactions
  - isPolymarketContract(): Check if address is Polymarket contract
  - getPolymarketContractName(): Get contract name for address
- Updated src/api/chain/index.ts to export all new types and functions:
  - Types: PolymarketContractName, FunctionSelector, DecodedInteraction,
    DecodedInteractionType, DecodedFillOrder, DecodedFillOrders, DecodedCancelOrder,
    DecodedSplitPosition, DecodedMergePositions, DecodedRedeemPositions,
    DecodedTokenTransfer, DecodedTokenApprove, DecodedCTFTransfer,
    DecodedConvertPositions, DecodedUnknown, AnyDecodedInteraction,
    ContractDecoderConfig, ContractDecoderLogger
  - Constants: POLYMARKET_CONTRACTS, FUNCTION_SELECTORS
  - Class: ContractDecoder
- Created tests/api/chain/contract-decoder.test.ts with 79 test cases covering:
  - Constructor (default config, custom config, additional contracts, custom logger)
  - isPolymarketContract (known contracts, unknown, case-insensitive, invalid)
  - getContractName (CTF Exchange, USDC, unknown, invalid)
  - getFunctionInfo (transfer, fillOrder, unknown, case-insensitive)
  - ERC20 transfers (transfer, transferFrom, USDC/USDC.e token info)
  - ERC20 approve (normal, unlimited detection)
  - CTF Exchange orders (fillOrder, fillOrders batch, cancelOrder, cancelOrders)
  - Conditional Token operations (splitPosition, mergePositions, redeemPositions)
  - CTF transfers (safeTransferFrom, safeBatchTransferFrom)
  - NegRisk Exchange (convertPositions)
  - Unknown/edge cases (unknown selector, empty input, short input, invalid address)
  - Parameter decoding toggle
  - batchDecode, filterByType, filterPolymarketOnly
  - Factory functions and singleton management
  - Convenience functions
  - POLYMARKET_CONTRACTS and FUNCTION_SELECTORS constants
  - Edge cases (malformed hex, long input, case normalization)
  - Real-world scenarios (trading flow, batch operations)
- All 2427 tests pass (79 new tests added)
- TypeScript typecheck passes
- Next up: API-CHAIN-007 (Track USDC transfers to Polymarket)


## API-CHAIN-007: Track USDC Transfers to Polymarket - COMPLETED
- Created src/api/chain/usdc-tracker.ts with USDCTracker class:
  - Monitor USDC deposits from wallets to Polymarket contracts
  - Support for both USDC and USDC.e tokens on Polygon
  - Constants defined:
    - USDC_ADDRESSES: USDC and USDC.e token addresses
    - POLYMARKET_DEPOSIT_CONTRACTS: CTF_EXCHANGE, NEG_RISK_CTF_EXCHANGE, CONDITIONAL_TOKENS, ROUTER
    - TRANSFER_EVENT_TOPIC: ERC20 Transfer event signature
  - Types defined:
    - USDCTokenType: "USDC" | "USDC.e"
    - TransferDirection: "deposit" | "withdrawal"
    - USDCTransfer: Complete transfer information
    - WalletDepositSummary: Aggregated deposit statistics
    - USDCTrackerEvent: Event emission types
  - USDCTracker class features:
    - getWalletTransfers(): Fetch all USDC transfers for a wallet
    - getPolymarketDeposits(): Get only Polymarket deposits
    - getPolymarketWithdrawals(): Get only Polymarket withdrawals
    - getDepositSummary(): Calculate deposit statistics
    - isPolymarketContract(): Check if address is a deposit contract
    - getPolymarketContractName(): Get contract name
    - isUSDCContract(): Check if address is USDC token
    - getUSDCTokenType(): Get token type from address
    - processTransfer(): Emit events for transfers
    - formatUSDC(): Format bigint to human-readable string
    - parseUSDC(): Parse string to bigint
    - getStats(): Get tracker statistics
  - Event emission:
    - "deposit": Emitted for Polymarket deposits
    - "withdrawal": Emitted for Polymarket withdrawals
    - "largeDeposit": Emitted when deposit exceeds threshold
    - "largeWithdrawal": Emitted when withdrawal exceeds threshold
  - Configurable options:
    - polygonscanClient: Custom client for fetching transactions
    - largeDepositThreshold: Threshold for large deposit alerts (default: 10000)
    - largeWithdrawalThreshold: Threshold for large withdrawal alerts (default: 10000)
    - includeUsdcE: Whether to track USDC.e transfers (default: true)
    - additionalContracts: Custom contract addresses to monitor
    - debug: Enable debug logging
    - logger: Custom logger implementation
- Factory functions:
  - createUSDCTracker(): Create new instance
  - getSharedUSDCTracker(): Get singleton instance
  - setSharedUSDCTracker(): Set singleton instance
  - resetSharedUSDCTracker(): Reset singleton
- Convenience functions:
  - getUSDCTransfers(): Get transfers for wallet
  - getPolymarketDeposits(): Get deposits for wallet
  - getPolymarketWithdrawals(): Get withdrawals for wallet
  - getWalletDepositSummary(): Get deposit summary
  - isPolymarketDepositContract(): Check if Polymarket contract
  - isUSDCTokenContract(): Check if USDC contract
  - formatUSDCAmount(): Format amount
  - parseUSDCAmount(): Parse amount string
- Updated src/api/chain/index.ts to export all new types and functions:
  - Types: USDCTokenType, TransferDirection, USDCTransfer, WalletDepositSummary,
    USDCTrackerEventType, USDCTrackerEvent, USDCTrackerEventListener,
    USDCTrackerConfig, USDCTrackerLogger
  - Constants: USDC_ADDRESSES, POLYMARKET_DEPOSIT_CONTRACTS, TRANSFER_EVENT_TOPIC
  - Class: USDCTracker
- Created tests/api/chain/usdc-tracker.test.ts with 89 test cases covering:
  - Constructor (default config, custom config, additional contracts, custom logger)
  - isPolymarketContract (CTF Exchange, NegRisk, Conditional Tokens, Router, unknown)
  - getPolymarketContractName (all contracts, unknown, empty)
  - isUSDCContract (USDC, USDC.e, non-USDC, disabled USDC.e)
  - getUSDCTokenType (USDC, USDC.e, unknown, empty)
  - formatUSDC (small, decimals, large, zero, less than 1, negative, precision)
  - parseUSDC (whole, decimal, full precision, excess decimals, zero)
  - getWalletTransfers (invalid address, empty address, valid wallet, filter non-USDC, pagination, block range)
  - getPolymarketDeposits (filter only deposits)
  - getPolymarketWithdrawals (filter only withdrawals)
  - getDepositSummary (invalid address, calculate totals, formatted amounts)
  - processTransfer (deposit event, withdrawal event, largeDeposit, largeWithdrawal, threshold)
  - getStats (configuration values, contract count)
  - Factory functions and singleton management
  - Convenience functions
  - Constants (USDC_ADDRESSES, POLYMARKET_DEPOSIT_CONTRACTS, TRANSFER_EVENT_TOPIC)
  - Edge cases (empty transfers, mixed case, address normalization, large/small amounts)
  - Real-world scenarios (deposits, withdrawals, multiple operations)
- All 2516 tests pass (89 new tests added)
- TypeScript typecheck passes
- Browser smoke test passes
- Next up: API-CHAIN-008 (Identify wallet funding sources)


## API-CHAIN-008: Identify Wallet Funding Sources - COMPLETED
- Created src/api/chain/funding-source.ts with FundingSourceTracker class:
  - Trace where wallet funds originated from
  - Identify known exchange wallets (CEX addresses)
  - Flag mixer/privacy tools (Tornado Cash, Railgun, etc.)
  - Build funding graph for visualization
  - Calculate risk scores and risk levels
- Constants defined:
  - KNOWN_EXCHANGES: Record of known CEX addresses (Binance, Coinbase, Kraken, OKX, KuCoin, Gate.io, Huobi, Bybit, Gemini, Bitfinex)
  - KNOWN_MIXERS: Record of known mixer/privacy tool addresses (Tornado Cash pools, Railgun)
  - KNOWN_DEFI_PROTOCOLS: Record of known DeFi protocols (Uniswap, QuickSwap, SushiSwap, 1inch, Aave, Curve, Stargate, Multichain, Polygon Bridge)
- Types defined:
  - ExchangeInfo: Exchange wallet information (name, type, subtype, trustLevel)
  - MixerInfo: Mixer/privacy tool info (name, type, riskLevel, sanctioned, description)
  - DefiProtocolInfo: DeFi protocol info (name, type, trustLevel)
  - FundingSourceType: "exchange" | "mixer" | "defi" | "contract" | "eoa" | "unknown"
  - FundingRiskLevel: "critical" | "high" | "medium" | "low" | "none"
  - FundingSource: Individual funding source details
  - FundingEdge: Edge in the funding graph
  - FundingGraph: Complete graph with nodes and edges
  - FundingGraphNode: Node in the funding graph
  - FundingAnalysis: Complete analysis result
  - RiskFactor: Risk factor detail with points
  - FundingSummary: Summary statistics
  - FundingSourceConfig: Tracker configuration
  - FundingSourceEvent: Event data
- FundingSourceTracker class features:
  - analyzeFundingSources(): Full analysis of wallet funding with graph, risk, summary
  - getIncomingTransfers(): Get incoming transfers to a wallet
  - isExchange(): Check if address is a known exchange
  - getExchangeInfo(): Get exchange info for address
  - isMixer(): Check if address is a known mixer
  - getMixerInfo(): Get mixer info for address
  - isDefiProtocol(): Check if address is a known DeFi protocol
  - getDefiProtocolInfo(): Get DeFi protocol info for address
  - isSanctioned(): Check if address is sanctioned (OFAC)
  - identifyAddressType(): Identify the type of an address
  - getRiskLevel(): Get risk level for an address
  - getStats(): Get tracker statistics
- Risk calculation:
  - 50 points for sanctioned sources (critical)
  - 30 points for non-sanctioned mixer sources (high)
  - 15 points for high unknown ratio (>50%)
  - 10 points for deep funding chains (depth > 2)
  - Risk levels: critical (>=50), high (>=30), medium (>=15), low (>0), none (0)
- Event emission:
  - "sourceIdentified": When a funding source is identified
  - "mixerDetected": When mixer/privacy tool is detected
  - "exchangeDetected": When exchange wallet is detected
  - "analysisComplete": When analysis completes
  - "error": On errors
- Configurable options:
  - polygonscanClient: Custom client for fetching transactions
  - maxDepth: Maximum depth to trace (default: 3)
  - minTransferAmount: Minimum transfer amount to consider (default: 1 USDC)
  - maxFundingSources: Maximum sources to return (default: 50)
  - lookbackBlocks: Number of blocks to look back
  - additionalExchanges: Custom exchange addresses to track
  - additionalMixers: Custom mixer addresses to track
  - additionalDefiProtocols: Custom DeFi protocol addresses to track
  - debug: Enable debug logging
  - logger: Custom logger implementation
- Factory functions:
  - createFundingSourceTracker(): Create new instance
  - getSharedFundingSourceTracker(): Get singleton instance
  - setSharedFundingSourceTracker(): Set singleton instance
  - resetSharedFundingSourceTracker(): Reset singleton
- Convenience functions:
  - analyzeFundingSources(): Analyze wallet funding
  - getWalletFundingTransfers(): Get incoming transfers
  - isKnownExchange(): Check if known exchange
  - isKnownMixer(): Check if known mixer
  - isSanctionedAddress(): Check if sanctioned
  - getExchangeInfoForAddress(): Get exchange info
  - getMixerInfoForAddress(): Get mixer info
  - identifyAddress(): Identify address type
  - getAddressRiskLevel(): Get risk level
- Updated src/api/chain/index.ts to export all new types and functions
- Created tests/api/chain/funding-source.test.ts with 106 test cases covering:
  - Constructor (default config, custom config, additional addresses, custom logger)
  - isExchange (Binance, Coinbase, Kraken, non-exchange, case-insensitive)
  - getExchangeInfo (Binance, Coinbase, unknown)
  - isMixer (Tornado Cash pools, Railgun, non-mixer, case-insensitive)
  - getMixerInfo (Tornado Cash sanctioned, Railgun not sanctioned)
  - isDefiProtocol (Uniswap, Polygon Bridge, Aave, case-insensitive)
  - getDefiProtocolInfo (Uniswap, Polygon Bridge)
  - isSanctioned (Tornado Cash true, Railgun false, exchange false)
  - identifyAddressType (exchange, mixer, defi, eoa, unknown)
  - getRiskLevel (critical for sanctioned, high for mixers, low for exchanges)
  - getStats (counts for all known addresses)
  - getIncomingTransfers (validation, filtering, pagination)
  - analyzeFundingSources (exchange sources, mixer sources, summaries, events, graphs)
  - Risk calculation (sanctioned points, mixer points, risk levels)
  - Factory functions and singleton management
  - Convenience functions
  - Constants (KNOWN_EXCHANGES, KNOWN_MIXERS, KNOWN_DEFI_PROTOCOLS)
  - Edge cases (mixed case, large amounts, zero transfers, self-transfers, multiple transfers)
  - Real-world scenarios (multiple exchanges, mixer funding, DeFi protocols, bridges)
- All 2622 tests pass (106 new tests added)
- TypeScript typecheck passes
- Next up: API-DB-001 (Database schema design)

=== Session 2026-01-11 ===

COMPLETED: API-DB-001 - Database schema design
- Designed comprehensive database schema in prisma/schema.prisma
- Entity relationships:
  - Market has many Outcomes, Trades, PriceHistory, MarketSnapshots, Alerts
  - Outcome belongs to Market, has many Trades, PriceHistory
  - Wallet has many Trades, Alerts, WalletSnapshots, FundingSources, ClusterMemberships
  - Trade belongs to Market, Outcome, Wallet
  - Alert may reference Market, Wallet
  - WalletCluster has many WalletClusterMembers
  - WalletClusterMember links Wallet to WalletCluster
- New models added:
  - WalletFundingSource: Tracks funding sources with risk levels
  - WalletCluster: Groups related wallets
  - WalletClusterMember: Many-to-many wallet-cluster relationship
  - MarketSnapshot: Periodic market state snapshots
  - WalletSnapshot: Periodic wallet state snapshots
  - SystemConfig: Key-value configuration store
  - SyncLog: Data synchronization tracking
  - JobQueue: Background job processing
- Enhanced existing models:
  - Market: Added subcategory, tags, imageUrl, iconUrl, resolution, volume24h, tradeCount, uniqueTraders, lastSyncedAt
  - Outcome: Added clobTokenId, priceChange24h, volume, winner, payout, displayOrder
  - Wallet: Added walletType, isFresh, isMonitored, isFlagged, isSanctioned, riskLevel, totalPnl, winCount, avgTradeSize, maxTradeSize, walletAgeDays, primaryFundingSource, onChainTxCount, metadata, notes
  - Trade: Added clobTradeId, matchId, feeUsd, makerAddress, takerAddress, isMaker, blockNumber, isInsider, flags
  - Alert: Added severity, title, tags, acknowledged, dismissed, actionBy, actionAt, expiresAt
  - PriceHistory: Added tradeCount, bestBid, bestAsk, spread, interval
- Enumerations added:
  - WalletType: UNKNOWN, EOA, CONTRACT, EXCHANGE, DEFI, MARKET_MAKER, INSTITUTIONAL, BOT
  - RiskLevel: NONE, LOW, MEDIUM, HIGH, CRITICAL
  - FundingSourceType: EXCHANGE, MIXER, DEFI, CONTRACT, EOA, UNKNOWN
  - ClusterType: UNKNOWN, SAME_ENTITY, SAME_FUNDING, SIMILAR_TRADING, COORDINATED, BOT_NETWORK
  - AlertType: 12 types for different alert scenarios
  - AlertSeverity: INFO, LOW, MEDIUM, HIGH, CRITICAL
  - TradeSide: BUY, SELL
  - TimeInterval: MINUTE_1, MINUTE_5, MINUTE_15, HOUR_1, HOUR_4, DAY_1, WEEK_1
  - SyncStatus: RUNNING, COMPLETED, FAILED, CANCELLED
  - JobStatus: PENDING, RUNNING, COMPLETED, FAILED, CANCELLED, SCHEDULED
- Indexing strategy:
  - Primary keys on all id fields
  - Unique indexes on slug, address, clobTradeId, clobTokenId, cluster memberships
  - Foreign key indexes on all relation fields
  - Query pattern indexes on timestamp, status, category, volume fields
  - Composite indexes for common query patterns
- Partitioning strategy documented:
  - Trade and PriceHistory tables designed for time-based partitioning
  - Timestamps and indexes optimized for range queries
  - Historical data can be archived based on age
- Documentation:
  - Created docs/database-schema.md with:
    - Entity relationship diagram (ASCII)
    - All models with field descriptions
    - All enumerations with values
    - Indexing strategy explanation
    - Partitioning strategy recommendations
    - Data retention guidelines
- Verified: npx prisma validate passes
- Verified: pnpm typecheck passes
- Verified: All 2622 tests pass
- Next up: API-DB-002 (Markets table and model)

NOTES:
- The schema is fully documented in docs/database-schema.md
- Prisma schema includes comments (///) for all fields to generate documentation
- Schema supports all detection features (fresh wallet, clustering, funding sources)
- Time-series data supports multiple intervals for different aggregation levels
- Job queue and sync log support background processing and data synchronization


COMPLETED: API-DB-002 - Markets table and model
- Created src/db/ directory with modular database service architecture
- Created src/db/client.ts:
  - PrismaClient singleton with lazy initialization
  - Support for development mode (persists across hot reloads)
  - createPrismaClient() factory function
  - getPrismaClient() singleton accessor
  - disconnectPrisma() for cleanup
  - resetPrismaClient() for testing
  - setPrismaClient() for mock injection
- Created src/db/markets.ts:
  - MarketService class with comprehensive CRUD operations
  - create(): Create a new market with required/optional fields
  - createWithOutcomes(): Create market with outcomes in single transaction
  - findById(): Find market by ID with optional outcomes include
  - findBySlug(): Find market by URL slug
  - findByIds(): Find multiple markets by ID array
  - update(): Update market fields
  - upsert(): Create or update market
  - delete(): Delete single market
  - deleteMany(): Delete multiple markets
  - findMany(): Query markets with filters, sorting, pagination
  - findActive(): Find active, non-closed markets
  - findByCategory(): Find markets by category
  - search(): Search markets by question text (case-insensitive)
  - getTrending(): Get top markets by volume
  - getRecent(): Get recently created markets
  - count(): Count markets matching filters
  - exists(): Check if market exists by ID
  - existsBySlug(): Check if market exists by slug
  - createMany(): Bulk create markets (skip duplicates)
  - markSynced(): Update last synced timestamp
  - getNeedingSync(): Find markets needing data sync
  - getStats(): Aggregate statistics (count, volume, liquidity)
- Created src/db/index.ts with exports for all db module components
- Added package.json scripts:
  - db:generate: Run prisma generate
  - db:push: Run prisma db push
  - db:migrate: Run prisma migrate dev
  - db:studio: Run prisma studio
  - postinstall: Auto-run prisma generate
- Type exports:
  - Market, Outcome (from Prisma)
  - MarketWithOutcomes (Market + outcomes relation)
  - CreateMarketInput, UpdateMarketInput
  - CreateOutcomeInput
  - MarketFilters, MarketSortOptions
  - PaginationOptions, PaginatedMarketResult
  - MarketServiceConfig
- Filter support:
  - active, closed, archived status
  - category, subcategory
  - tags (hasSome)
  - search (question contains)
  - minVolume, maxVolume
  - endDateBefore, endDateAfter
  - createdBefore, createdAfter
- Sort support: volume, volume24h, liquidity, createdAt, updatedAt, endDate, tradeCount
- Created tests/db/markets.test.ts with 64 unit tests:
  - Constructor tests
  - Create tests (required fields, all fields, defaults)
  - CreateWithOutcomes tests (outcomes, probability calculation)
  - FindById tests (found, not found, with outcomes)
  - FindBySlug tests (found, not found, with outcomes)
  - FindByIds tests (multiple, empty)
  - Update tests (multiple fields, single field, nullable)
  - Upsert tests (create new, update existing)
  - Delete tests (single, many)
  - FindMany tests (all filters, sorting, pagination, outcomes)
  - FindActive tests
  - FindByCategory tests (active only, all)
  - Search tests (active only, all)
  - GetTrending tests (default, with category)
  - GetRecent tests (active only, all)
  - Count tests (no filters, with filters)
  - Exists/ExistsBySlug tests
  - CreateMany tests (bulk, skip duplicates)
  - MarkSynced tests
  - GetNeedingSync tests
  - GetStats tests (aggregates, null handling, with filters)
  - Edge cases (empty tags, min/max volume only, all sort fields)
- All 2686 tests pass (64 new tests added)
- TypeScript typecheck passes
- Prisma schema validation passes
- Next up: API-DB-003 (Trades table and model)

NOTES:
- Market model was already defined in schema from API-DB-001
- This feature focuses on the service layer for database operations
- Tests use mocked Prisma client to avoid database dependency
- MarketService can be injected with custom Prisma client for testing
- Default singleton instance available via marketService export


COMPLETED: API-DB-003 - Trades table and model
- Created src/db/trades.ts with comprehensive TradeService class
- TradeService provides full CRUD operations for the Trade model:
  - create(): Create a new trade with required/optional fields
  - findById(): Find trade by ID with optional relation includes
  - findByClobTradeId(): Find trade by CLOB trade ID
  - findByIds(): Find multiple trades by ID array
  - update(): Update trade fields
  - upsertByClobTradeId(): Create or update trade by CLOB ID
  - delete(): Delete single trade
  - deleteMany(): Delete multiple trades by IDs
  - deleteByMarket(): Delete all trades for a market
  - deleteByWallet(): Delete all trades for a wallet
  - findMany(): Query trades with filters, sorting, pagination
  - findByWallet(): Find trades for a specific wallet
  - findByMarket(): Find trades for a specific market
  - findByOutcome(): Find trades for a specific outcome
  - findWhaleTrades(): Find trades flagged as whale activity
  - findInsiderTrades(): Find trades flagged as insider activity
  - getRecent(): Get most recent trades
  - getLargest(): Get largest trades by USD value
  - findInTimeRange(): Find trades within a time range
  - count(): Count trades matching filters
  - exists(): Check if trade exists by ID
  - existsByClobTradeId(): Check if trade exists by CLOB ID
  - createMany(): Bulk create trades (skip duplicates)
  - markAsWhale(): Flag a trade as whale activity
  - markAsInsider(): Flag a trade as insider activity
  - addFlags(): Add flags to a trade (merges with existing)
  - getStats(): Aggregate statistics (count, volume, avg size, fees)
  - getWalletStats(): Trade statistics for a specific wallet
  - getMarketStats(): Trade statistics for a specific market
  - findFirstTradeByWallet(): Find first trade for a wallet
  - findLastTradeByWallet(): Find last trade for a wallet
  - getTradesByInterval(): Get trades grouped by time interval for charting
- Type exports:
  - Trade, TradeSide (from Prisma)
  - TradeWithMarket, TradeWithOutcome, TradeWithWallet, TradeWithRelations
  - CreateTradeInput, UpdateTradeInput
  - TradeFilters, TradeSortOptions
  - PaginationOptions, PaginatedTradeResult
  - TradeIncludeOptions, TradeServiceConfig, TradeStats
- Filter support:
  - marketId, outcomeId, walletId
  - side (BUY/SELL)
  - isWhale, isInsider
  - matchId, txHash
  - makerAddress, takerAddress
  - minUsdValue, maxUsdValue
  - timestampAfter, timestampBefore
  - flags (hasSome)
- Sort support: timestamp, usdValue, amount, price, createdAt
- Created tests/db/trades.test.ts with 76 comprehensive unit tests:
  - Constructor tests
  - Create tests (required fields, all fields, defaults)
  - FindById tests (found, not found, with each relation, all relations)
  - FindByClobTradeId tests
  - FindByIds tests
  - Update tests (fields, nullable to null)
  - UpsertByClobTradeId tests (create new, update existing)
  - Delete tests (single, many, by market, by wallet)
  - FindMany tests (all filters, sorting, pagination, includes)
  - FindByWallet, FindByMarket, FindByOutcome tests
  - FindWhaleTrades, FindInsiderTrades tests
  - GetRecent, GetLargest tests
  - FindInTimeRange tests
  - Count tests (no filters, with filters)
  - Exists/ExistsByClobTradeId tests
  - CreateMany tests
  - MarkAsWhale, MarkAsInsider tests
  - AddFlags tests (add new, merge existing, dedupe, not found)
  - GetStats tests (aggregates, null handling, with filters)
  - GetWalletStats, GetMarketStats tests
  - FindFirstTradeByWallet, FindLastTradeByWallet tests
  - GetTradesByInterval tests
  - Edge cases (all filter variations, all sort fields)
- Updated src/db/index.ts to export TradeService and types
- All 2762 tests pass (76 new tests added)
- TypeScript typecheck passes
- Next up: API-DB-004 (Wallets table and model)

NOTES:
- Trade model was already defined in Prisma schema from API-DB-001
- This feature focuses on the service layer for database operations
- Tests use mocked Prisma client to avoid database dependency
- TradeService can be injected with custom Prisma client for testing
- Default singleton instance available via tradeService export
- Relations (market, outcome, wallet) can be optionally included in queries
- Time-series grouping done in memory for simplicity (can optimize with DB functions)


COMPLETED: API-DB-004 - Wallets table and model
- Created src/db/wallets.ts with comprehensive WalletService class
- WalletService provides full CRUD operations for the Wallet model:
  - create(): Create a new wallet with address normalization
  - findById(): Find wallet by ID with optional relation includes
  - findByAddress(): Find wallet by address (normalized to lowercase)
  - findByIds(): Find multiple wallets by ID array
  - findByAddresses(): Find multiple wallets by address array
  - update(): Update wallet fields
  - updateByAddress(): Update wallet by address
  - upsertByAddress(): Create or update wallet by address
  - delete(): Delete single wallet by ID
  - deleteByAddress(): Delete wallet by address
  - deleteMany(): Delete multiple wallets by IDs
  - findMany(): Query wallets with filters, sorting, pagination
  - findWhales(): Find whale wallets
  - findInsiders(): Find insider wallets
  - findFresh(): Find fresh/new wallets
  - findMonitored(): Find monitored wallets
  - findFlagged(): Find flagged wallets
  - findSanctioned(): Find sanctioned wallets
  - findByRiskLevel(): Find wallets by risk level
  - findHighRisk(): Find MEDIUM, HIGH, CRITICAL risk wallets
  - getTopByVolume(): Top wallets by total volume
  - getTopBySuspicionScore(): Top wallets by suspicion score
  - getTopByTradeCount(): Top wallets by trade count
  - getTopByPnl(): Top wallets by PnL
  - getRecentlyActive(): Recently active wallets
  - getNewest(): Newest wallets
  - count(): Count wallets matching filters
  - exists(): Check if wallet exists by ID
  - existsByAddress(): Check if wallet exists by address
  - createMany(): Bulk create wallets (skip duplicates)
  - markAsWhale(): Flag wallet as whale
  - markAsInsider(): Flag wallet as insider
  - markAsFresh(): Flag wallet as fresh
  - markAsMonitored(): Flag wallet for monitoring
  - markAsFlagged(): Flag wallet for suspicious activity
  - markAsSanctioned(): Flag wallet as sanctioned (sets CRITICAL risk)
  - unmark(): Remove a flag from wallet
  - updateSuspicionScore(): Update score with auto risk level calculation
  - updateRiskLevel(): Update risk level directly
  - incrementTradeStats(): Increment trade count, volume, etc.
  - updateOnChainData(): Update wallet creation date, tx count, age
  - getStats(): Aggregate statistics (count, volume, suspicion, flags)
  - getCountByRiskLevel(): Wallet counts grouped by risk level
  - getCountByWalletType(): Wallet counts grouped by wallet type
  - search(): Search wallets by address or label
  - findOrCreate(): Find or create wallet by address
- Type exports:
  - Wallet, WalletType, RiskLevel, FundingSourceType (from Prisma)
  - WalletWithTrades, WalletWithAlerts, WalletWithFundingSources
  - WalletWithSnapshots, WalletWithClusters, WalletWithRelations
  - CreateWalletInput, UpdateWalletInput
  - WalletFilters, WalletSortOptions
  - PaginationOptions, PaginatedWalletResult
  - WalletIncludeOptions, WalletServiceConfig, WalletStats
- Filter support:
  - walletType, isWhale, isInsider, isFresh, isMonitored, isFlagged, isSanctioned
  - riskLevel, primaryFundingSource
  - minSuspicionScore, maxSuspicionScore
  - minTotalVolume, maxTotalVolume
  - minTradeCount, maxTradeCount
  - minWinRate, maxWinRate
  - firstTradeAfter, firstTradeBefore
  - lastTradeAfter, lastTradeBefore
  - walletCreatedAfter, walletCreatedBefore
  - labelContains, addressContains
- Sort support: suspicionScore, totalVolume, totalPnl, tradeCount, winRate,
  firstTradeAt, lastTradeAt, walletCreatedAt, createdAt, updatedAt
- Created tests/db/wallets.test.ts with 122 comprehensive unit tests:
  - Constructor tests
  - Create tests (required fields, all fields, address normalization)
  - FindById tests (found, not found, with each relation, all relations)
  - FindByAddress tests (found, not found, normalization)
  - FindByIds, FindByAddresses tests
  - Update tests (fields, nullable to null)
  - UpdateByAddress tests
  - UpsertByAddress tests (create new, update existing)
  - Delete tests (by ID, by address, deleteMany)
  - FindMany tests (all filters, sorting, pagination, hasMore)
  - FindWhales, FindInsiders, FindFresh, FindMonitored, FindFlagged, FindSanctioned tests
  - FindByRiskLevel, FindHighRisk tests
  - GetTopBy* tests (volume, suspicionScore, tradeCount, PnL)
  - GetRecentlyActive, GetNewest tests
  - Count tests (no filters, with filters)
  - Exists/ExistsByAddress tests
  - CreateMany tests
  - Mark* tests (whale, insider, fresh, monitored, flagged, sanctioned)
  - Unmark tests
  - UpdateSuspicionScore tests (all risk levels, clamping)
  - UpdateRiskLevel tests
  - IncrementTradeStats tests (stats update, max size, win tracking, firstTradeAt)
  - UpdateOnChainData tests
  - GetStats tests (aggregates, null handling)
  - GetCountByRiskLevel, GetCountByWalletType tests
  - Search tests (by address, by label)
  - FindOrCreate tests (existing, new, with defaults)
  - All sort field variations
- Updated src/db/index.ts to export WalletService and types
- All 2884 tests pass (122 new tests added)
- TypeScript typecheck passes
- Next up: API-DB-005 (Alerts table and model)

NOTES:
- Wallet model was already defined in Prisma schema from API-DB-001
- This feature focuses on the service layer for database operations
- Tests use mocked Prisma client to avoid database dependency
- WalletService can be injected with custom Prisma client for testing
- Default singleton instance available via walletService export
- Address normalization ensures consistent lowercase storage/lookup
- SuspicionScore auto-determines riskLevel based on thresholds (0-20:NONE, 20-40:LOW, 40-60:MEDIUM, 60-80:HIGH, 80+:CRITICAL)
- Relations (trades, alerts, fundingSources, snapshots, walletClusters) can be optionally included in queries

=== API-DB-005: Alerts table and model ===
Date: 2026-01-11

COMPLETED:
- Created src/db/alerts.ts with AlertService class
- Alert model was already defined in Prisma schema from API-DB-001
- Created comprehensive AlertService with full CRUD operations

AlertService Features:
- Core CRUD:
  - create(): Create new alert with type, severity, title, message
  - findById(): Find alert by ID with optional relations
  - findByIds(): Find multiple alerts by IDs
  - update(): Update alert fields
  - delete(): Delete single alert
  - deleteMany(): Bulk delete alerts
  - createMany(): Bulk create alerts

- Query Methods:
  - findMany(): Query with filters, sorting, pagination
  - findByType(): Filter by alert type
  - findBySeverity(): Filter by severity level
  - findUnread(): Find unread alerts
  - findUnacknowledged(): Find unacknowledged alerts
  - findActive(): Find non-dismissed, non-expired alerts
  - findCritical(): Find HIGH and CRITICAL severity alerts
  - findByWallet(): Find alerts for specific wallet
  - findByMarket(): Find alerts for specific market
  - getRecent(): Get recent alerts
  - getRecentUnread(): Get recent unread alerts
  - count(): Count alerts matching filters
  - exists(): Check if alert exists

- Alert Actions:
  - markAsRead(): Mark single alert as read
  - markManyAsRead(): Bulk mark as read
  - markAllAsRead(): Mark all matching alerts as read
  - acknowledge(): Acknowledge alert with optional user
  - acknowledgeMany(): Bulk acknowledge
  - dismiss(): Dismiss alert with optional user
  - dismissMany(): Bulk dismiss

- Cleanup Methods:
  - deleteExpired(): Delete expired alerts
  - deleteOldDismissed(): Delete old dismissed alerts

- Statistics:
  - getStats(): Aggregate statistics (count, unread, by severity, by type)
  - getCountBySeverity(): Counts grouped by severity
  - getCountByType(): Counts grouped by type
  - search(): Search alerts by title or message

- Utility:
  - getSeverityPriority(): Get numeric priority for severity
  - compareBySeverity(): Compare alerts for sorting

- Filter support:
  - type, types (multiple)
  - severity, severities (multiple)
  - marketId, walletId
  - read, acknowledged, dismissed
  - hasTag, hasTags (any match)
  - createdAfter, createdBefore
  - expiresAfter, expiresBefore
  - notExpired
  - titleContains, messageContains

- Sort support: createdAt, severity, type, expiresAt

- Type exports:
  - Alert, AlertType, AlertSeverity (from Prisma)
  - AlertWithMarket, AlertWithWallet, AlertWithRelations
  - CreateAlertInput, UpdateAlertInput
  - AlertFilters, AlertSortOptions
  - PaginationOptions, PaginatedAlertResult
  - AlertIncludeOptions, AlertServiceConfig, AlertStats

- Created tests/db/alerts.test.ts with 76 comprehensive unit tests:
  - Constructor tests
  - Create tests (required fields, all fields, default severity)
  - FindById tests (found, not found, with relations)
  - FindByIds tests
  - Update tests (fields, nullable to null)
  - Delete, DeleteMany tests
  - FindMany tests (all filters, sorting, pagination)
  - FindByType, FindBySeverity, FindUnread, FindUnacknowledged tests
  - FindActive, FindCritical tests
  - FindByWallet, FindByMarket tests
  - GetRecent, GetRecentUnread tests
  - Count, Exists tests
  - CreateMany tests
  - MarkAsRead, MarkManyAsRead, MarkAllAsRead tests
  - Acknowledge, AcknowledgeMany tests
  - Dismiss, DismissMany tests
  - DeleteExpired, DeleteOldDismissed tests
  - GetStats tests
  - GetCountBySeverity, GetCountByType tests
  - Search tests
  - GetSeverityPriority, CompareBySeverity tests

- Updated src/db/index.ts to export AlertService and types
- All 2960 tests pass (76 new tests added)
- TypeScript typecheck passes
- Next up: API-DB-006 (Historical snapshots table)

NOTES:
- Alert model was already defined in Prisma schema from API-DB-001
- This feature focuses on the service layer for database operations
- Tests use mocked Prisma client to avoid database dependency
- AlertService can be injected with custom Prisma client for testing
- Default singleton instance available via alertService export
- Supports multiple alert types: WHALE_TRADE, PRICE_MOVEMENT, INSIDER_ACTIVITY, etc.
- Severity levels: INFO, LOW, MEDIUM, HIGH, CRITICAL
- Alerts can be linked to markets and wallets via optional relations
- Read/acknowledged/dismissed status tracking for alert lifecycle
- Expiration support for time-sensitive alerts

